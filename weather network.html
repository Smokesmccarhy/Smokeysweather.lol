<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smokey's Weather Network</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Oswald:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SMOKEY'S WEATHER NETWORK â€” GLOBAL STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#04090f;
  --surface:#071018;
  --panel:rgba(7,16,28,0.92);
  --card:rgba(10,22,40,0.8);
  --navy:#0a1628;
  --blue:#1565c0;
  --blue2:#1e88e5;
  --sky:#42a5f5;
  --cyan:#00bcd4;
  --teal:#00acc1;
  --gold:#f59e0b;
  --gold2:#fbbf24;
  --red:#dc2626;
  --orange:#ea580c;
  --green:#16a34a;
  --text:#e2f0ff;
  --dim:#6b90b8;
  --border:rgba(66,165,245,0.15);
  --border-gold:rgba(245,158,11,0.2);
  --glow-blue:0 0 20px rgba(30,136,229,0.3);
  --glow-gold:0 0 20px rgba(245,158,11,0.3);
  --radius:10px;
  --transition:all 0.25s ease;
}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:'Montserrat',sans-serif;min-height:100vh;overflow-x:hidden;}
a{color:inherit;text-decoration:none;}
button{cursor:pointer;font-family:'Montserrat',sans-serif;}
input,select,textarea{font-family:'Montserrat',sans-serif;}

/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:var(--surface);}
::-webkit-scrollbar-thumb{background:var(--blue);border-radius:3px;}

/* â”€â”€ ANIMATED BG â”€â”€ */
.bg-scene{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none;}
.bg-grad{position:absolute;inset:0;background:
  radial-gradient(ellipse 80% 50% at 50% -5%,rgba(21,101,192,0.2) 0%,transparent 60%),
  radial-gradient(ellipse 50% 40% at 0% 100%,rgba(0,188,212,0.06) 0%,transparent 50%),
  linear-gradient(180deg,#04090f 0%,#071018 100%);}
.bg-cloud{position:absolute;border-radius:100px;background:rgba(66,165,245,0.025);filter:blur(60px);animation:bgdrift linear infinite;}
@keyframes bgdrift{0%{transform:translateX(-5%);}50%{transform:translateX(4%);}100%{transform:translateX(-5%);}}
.rain-wrap{position:absolute;inset:0;opacity:0;transition:opacity 2s;}
.rdrop{position:absolute;width:1px;background:linear-gradient(transparent,rgba(150,210,255,0.5));animation:rainfall linear infinite;}
@keyframes rainfall{from{transform:translateY(-60px);opacity:0.8;}to{transform:translateY(105vh);opacity:0.1;}}
.snow-wrap{position:absolute;inset:0;opacity:0;transition:opacity 2s;}
.snowflake{position:absolute;border-radius:50%;background:rgba(210,235,255,0.8);animation:snowfall linear infinite;}
@keyframes snowfall{0%{transform:translateY(-10px) translateX(0) rotate(0deg);opacity:1;}100%{transform:translateY(105vh) translateX(40px) rotate(360deg);opacity:0;}}
.lightning-flash{position:absolute;inset:0;background:rgba(200,220,255,0.1);opacity:0;}

/* â”€â”€ STARS â”€â”€ */
.starfield{position:absolute;inset:0;}
.star{position:absolute;border-radius:50%;background:#fff;animation:startwink var(--d) ease-in-out infinite alternate;}
@keyframes startwink{from{opacity:var(--lo);}to{opacity:var(--hi);}}

/* â•â• HEADER â•â• */
.site-header{
  position:sticky;top:0;z-index:100;
  background:linear-gradient(90deg,rgba(4,9,15,0.98) 0%,rgba(7,16,28,0.97) 100%);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(20px);
}
.header-top{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 24px;gap:16px;
  border-bottom:1px solid rgba(66,165,245,0.08);
}
/* Logo */
.logo{display:flex;align-items:center;gap:14px;flex-shrink:0;}
.logo-mark{
  width:54px;height:54px;border-radius:12px;
  background:linear-gradient(135deg,#1565c0,#0d47a1);
  display:flex;align-items:center;justify-content:center;font-size:26px;
  box-shadow:var(--glow-blue),inset 0 1px 0 rgba(255,255,255,0.1);
  animation:logopulse 4s ease-in-out infinite;
  position:relative;overflow:hidden;flex-shrink:0;
}
.logo-mark::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent);}
@keyframes logopulse{0%,100%{box-shadow:var(--glow-blue);}50%{box-shadow:0 0 35px rgba(30,136,229,0.5);}}
.logo-text-wrap{}
.logo-name{font-family:'Oswald',sans-serif;font-size:clamp(1.2rem,2.5vw,1.7rem);font-weight:700;letter-spacing:3px;color:#fff;line-height:1;text-shadow:0 0 20px rgba(66,165,245,0.4);}
.logo-name span{color:var(--sky);}
.logo-tagline{font-size:0.6rem;letter-spacing:4px;color:var(--dim);text-transform:uppercase;margin-top:3px;}

/* Header center â€” clock & alerts */
.header-center{display:flex;align-items:center;gap:16px;flex:1;justify-content:center;}
.live-badge{display:flex;align-items:center;gap:7px;background:rgba(220,38,38,0.12);border:1px solid rgba(220,38,38,0.35);border-radius:4px;padding:5px 12px;font-family:'Oswald',sans-serif;letter-spacing:3px;font-size:0.85rem;color:#ef4444;flex-shrink:0;}
.live-dot{width:7px;height:7px;border-radius:50%;background:#ef4444;animation:livedot 1s ease-in-out infinite;box-shadow:0 0 7px #ef4444;}
@keyframes livedot{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.25;transform:scale(0.5);}}
.alert-badge{display:none;align-items:center;gap:7px;background:rgba(234,88,12,0.12);border:1px solid rgba(234,88,12,0.4);border-radius:4px;padding:5px 12px;font-family:'Oswald',sans-serif;font-size:0.75rem;letter-spacing:2px;color:#fb923c;animation:alertpulse 1.5s ease-in-out infinite;}
.alert-badge.show{display:flex;}
@keyframes alertpulse{0%,100%{border-color:rgba(234,88,12,0.4);}50%{border-color:rgba(234,88,12,0.9);}}

/* Clock */
.header-clock{text-align:right;flex-shrink:0;}
.clock-time{font-family:'Roboto Mono',monospace;font-size:clamp(1.2rem,2vw,1.7rem);font-weight:500;color:#fff;letter-spacing:2px;line-height:1;}
.clock-date{font-size:0.6rem;color:var(--dim);letter-spacing:2px;text-transform:uppercase;margin-top:3px;}

/* â”€â”€ NAV â”€â”€ */
.main-nav{
  display:flex;align-items:center;overflow-x:auto;
  padding:0 24px;gap:2px;
  scrollbar-width:none;
}
.main-nav::-webkit-scrollbar{display:none;}
.nav-btn{
  background:transparent;border:none;color:var(--dim);
  font-family:'Oswald',sans-serif;font-weight:500;font-size:0.8rem;
  letter-spacing:2px;text-transform:uppercase;
  padding:12px 16px;white-space:nowrap;
  border-bottom:2px solid transparent;
  transition:var(--transition);margin-bottom:-1px;
}
.nav-btn:hover{color:var(--text);}
.nav-btn.active{color:var(--sky);border-bottom-color:var(--sky);}
.nav-btn i{margin-right:6px;font-size:0.75rem;}

/* â”€â”€ SEARCH BAR â”€â”€ */
.search-strip{
  background:rgba(7,16,28,0.9);
  border-bottom:1px solid var(--border);
  padding:10px 24px;
  display:flex;align-items:center;gap:10px;flex-wrap:wrap;
}
.search-box{display:flex;flex:1;max-width:500px;background:rgba(10,25,50,0.6);border:1px solid var(--border);border-radius:6px;overflow:hidden;transition:border-color 0.2s,box-shadow 0.2s;}
.search-box:focus-within{border-color:var(--sky);box-shadow:0 0 12px rgba(66,165,245,0.2);}
.search-box input{flex:1;background:transparent;border:none;outline:none;color:#fff;font-size:0.9rem;padding:10px 14px;letter-spacing:0.5px;}
.search-box input::placeholder{color:var(--dim);}
.search-box button{background:var(--blue2);border:none;color:#fff;padding:10px 18px;font-family:'Oswald',sans-serif;letter-spacing:2px;font-size:0.85rem;transition:background 0.2s;}
.search-box button:hover{background:var(--blue);}
.locate-btn{background:rgba(10,25,50,0.6);border:1px solid var(--border);color:var(--sky);padding:10px 13px;border-radius:6px;font-size:0.95rem;transition:var(--transition);}
.locate-btn:hover{background:rgba(66,165,245,0.1);border-color:var(--sky);}
.unit-toggle{display:flex;background:rgba(5,12,22,0.8);border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.unit-btn{background:transparent;border:none;color:var(--dim);padding:8px 16px;font-family:'Oswald',sans-serif;letter-spacing:2px;font-size:0.85rem;transition:var(--transition);}
.unit-btn.on{background:var(--sky);color:#04090f;font-weight:600;}
.err-msg{display:none;width:100%;background:rgba(220,38,38,0.1);border:1px solid rgba(220,38,38,0.3);border-radius:6px;padding:9px 14px;color:#fca5a5;font-size:0.82rem;}
.err-msg.show{display:block;}

/* â•â• PAGES â•â• */
.page{display:none;animation:pagein 0.3s ease;}
.page.active{display:block;}
@keyframes pagein{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}

/* â•â• HOME / DASHBOARD â•â• */
.dashboard{padding:20px 24px;display:grid;grid-template-columns:1fr 300px;gap:18px;max-width:1400px;margin:0 auto;}

/* Current conditions hero */
.conditions-hero{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius);padding:28px;
  position:relative;overflow:hidden;
  backdrop-filter:blur(12px);
}
.conditions-hero::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--sky),var(--cyan),transparent);}
.conditions-hero::after{content:'';position:absolute;top:-40px;right:-40px;width:160px;height:160px;border-radius:50%;background:radial-gradient(circle,rgba(66,165,245,0.06) 0%,transparent 70%);pointer-events:none;}

.city-row{display:flex;align-items:center;gap:10px;margin-bottom:4px;}
.city-pin{color:var(--gold);font-size:0.9rem;}
.city-name{font-family:'Oswald',sans-serif;font-size:1.8rem;font-weight:600;letter-spacing:1px;color:#fff;}
.city-region{font-size:0.7rem;color:var(--dim);margin-left:auto;letter-spacing:1px;}
.data-attr{font-size:0.58rem;color:var(--dim);opacity:0.55;letter-spacing:1.5px;margin-bottom:18px;}

.main-temp-row{display:flex;align-items:flex-end;gap:18px;margin:10px 0 6px;}
.wx-icon{font-size:clamp(3.5rem,6vw,5rem);animation:wxfloat 5s ease-in-out infinite;filter:drop-shadow(0 0 12px rgba(255,255,255,0.12));}
@keyframes wxfloat{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
.temp-big{font-family:'Oswald',sans-serif;font-size:clamp(4rem,8vw,6.5rem);font-weight:700;color:#fff;line-height:1;text-shadow:0 0 30px rgba(66,165,245,0.25);}
.temp-unit-lbl{font-family:'Oswald',sans-serif;font-size:1.8rem;font-weight:300;color:var(--dim);margin-bottom:10px;}
.condition-lbl{font-family:'Oswald',sans-serif;font-size:1.3rem;letter-spacing:3px;color:var(--sky);margin-bottom:22px;}

.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
@media(max-width:600px){.stats-grid{grid-template-columns:repeat(2,1fr);}}
.stat-card{background:rgba(0,0,0,0.25);border:1px solid rgba(66,165,245,0.09);border-radius:8px;padding:12px;text-align:center;transition:var(--transition);}
.stat-card:hover{border-color:rgba(66,165,245,0.25);background:rgba(30,80,150,0.1);}
.stat-lbl{font-size:0.58rem;color:var(--dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.stat-val{font-family:'Oswald',sans-serif;font-size:1.15rem;font-weight:600;color:#fff;letter-spacing:0.5px;}
.stat-icon{color:var(--sky);margin-right:3px;font-size:0.75rem;}

/* Right sidebar */
.dash-sidebar{display:flex;flex-direction:column;gap:14px;}

/* Widget cards */
.widget{background:var(--card);border:1px solid var(--border-gold);border-radius:var(--radius);padding:16px;backdrop-filter:blur(10px);}
.widget-title{font-family:'Oswald',sans-serif;font-size:0.68rem;letter-spacing:3px;text-transform:uppercase;color:var(--dim);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.widget-title::after{content:'';flex:1;height:1px;background:rgba(245,158,11,0.12);}

.feels-num{font-family:'Oswald',sans-serif;font-size:2.8rem;font-weight:700;color:#fff;line-height:1;}
.feels-desc{font-size:0.75rem;color:var(--dim);margin-top:5px;font-weight:300;}
.prog{height:5px;background:rgba(255,255,255,0.07);border-radius:3px;margin-top:12px;overflow:hidden;}
.prog-fill{height:100%;border-radius:3px;transition:width 1.2s ease;}
.prog-blue{background:linear-gradient(90deg,var(--blue),var(--sky));box-shadow:0 0 8px rgba(66,165,245,0.4);}
.prog-gold{background:linear-gradient(90deg,var(--gold),var(--gold2));box-shadow:0 0 8px rgba(245,158,11,0.4);}
.prog-teal{background:linear-gradient(90deg,var(--teal),var(--cyan));box-shadow:0 0 8px rgba(0,188,212,0.4);}

/* Sun widget */
.sun-arc{height:60px;width:100%;margin:8px 0;}
.sun-arc svg{width:100%;height:100%;}
.sun-times{display:flex;justify-content:space-between;}
.sun-item{text-align:center;}
.sun-icon{font-size:1.2rem;}
.sun-time-val{font-family:'Oswald',sans-serif;font-size:0.95rem;color:#ffcc80;}
.sun-time-lbl{font-size:0.58rem;color:var(--dim);letter-spacing:1px;}

/* AQI */
.aqi-num{font-family:'Oswald',sans-serif;font-size:2.5rem;font-weight:700;line-height:1;}
.aqi-label{font-size:0.72rem;letter-spacing:2px;margin-top:4px;}
.aqi-good{color:#4ade80;}
.aqi-moderate{color:#facc15;}
.aqi-unhealthy{color:#fb923c;}
.aqi-bad{color:#ef4444;}

/* Alert widget */
.alert-widget{background:rgba(220,38,38,0.06);border:1px solid rgba(220,38,38,0.25);display:none;}
.alert-widget.show{display:block;}
.alert-widget .widget-title{color:#fca5a5;}
.alert-count{font-family:'Oswald',sans-serif;font-size:2rem;color:#ef4444;line-height:1;}
.alert-list{margin-top:8px;}
.alert-item{font-size:0.75rem;color:#ffaaaa;padding:6px 0;border-bottom:1px solid rgba(220,38,38,0.1);display:flex;gap:8px;align-items:flex-start;font-weight:300;}
.alert-item:last-child{border-bottom:none;}
.alert-icon-sm{color:#ef4444;font-size:0.7rem;margin-top:2px;flex-shrink:0;}

/* Forecast section below dashboard */
.section-wrap{padding:0 24px 20px;max-width:1400px;margin:0 auto;}
.section-head{font-family:'Oswald',sans-serif;font-size:0.75rem;letter-spacing:4px;text-transform:uppercase;color:var(--dim);margin-bottom:12px;display:flex;align-items:center;gap:12px;}
.section-head::after{content:'';flex:1;height:1px;background:var(--border);}

/* 7-Day forecast */
.forecast7{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;}
@media(max-width:700px){.forecast7{grid-template-columns:repeat(4,1fr);}}
.fday{background:var(--card);border:1px solid rgba(66,165,245,0.08);border-radius:8px;padding:12px 8px;text-align:center;transition:var(--transition);}
.fday:hover,.fday.today{background:rgba(30,100,200,0.1);border-color:rgba(66,165,245,0.3);transform:translateY(-2px);}
.fday.today{border-color:var(--gold);}
.fday-name{font-family:'Oswald',sans-serif;font-size:0.7rem;letter-spacing:2px;color:var(--dim);margin-bottom:6px;}
.fday.today .fday-name{color:var(--gold);}
.fday-icon{font-size:1.6rem;margin:5px 0;}
.fday-hi{font-family:'Oswald',sans-serif;font-size:1.1rem;font-weight:600;color:#fff;}
.fday-lo{font-family:'Oswald',sans-serif;font-size:0.85rem;color:#93c5fd;font-weight:400;}
.fday-precip{font-size:0.6rem;color:#5b8db8;margin-top:4px;}

/* Hourly forecast */
.hourly-scroll{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px;scrollbar-width:none;}
.hourly-scroll::-webkit-scrollbar{display:none;}
.hour-card{flex-shrink:0;background:var(--card);border:1px solid rgba(66,165,245,0.08);border-radius:8px;padding:12px 10px;text-align:center;min-width:72px;transition:var(--transition);}
.hour-card:hover{border-color:rgba(66,165,245,0.25);}
.hour-card.now{border-color:var(--sky);background:rgba(66,165,245,0.08);}
.hour-time{font-size:0.65rem;color:var(--dim);letter-spacing:1px;margin-bottom:6px;font-family:'Roboto Mono',monospace;}
.hour-card.now .hour-time{color:var(--sky);}
.hour-icon{font-size:1.4rem;margin:4px 0;}
.hour-temp{font-family:'Oswald',sans-serif;font-size:1rem;font-weight:600;color:#fff;}
.hour-precip{font-size:0.58rem;color:#5b8db8;margin-top:3px;}

/* â•â• RADAR PAGE â•â• */
.radar-page{padding:20px 24px;max-width:1400px;margin:0 auto;}
.radar-container{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;position:relative;}
.radar-toolbar{padding:12px 16px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;border-bottom:1px solid var(--border);}
.radar-title{font-family:'Oswald',sans-serif;font-size:0.8rem;letter-spacing:3px;color:var(--dim);}
.radar-type-btn{background:rgba(10,25,50,0.6);border:1px solid var(--border);color:var(--dim);padding:6px 14px;border-radius:5px;font-family:'Oswald',sans-serif;font-size:0.75rem;letter-spacing:1px;transition:var(--transition);}
.radar-type-btn.on,.radar-type-btn:hover{background:rgba(66,165,245,0.15);border-color:var(--sky);color:var(--sky);}
.radar-frame{width:100%;height:520px;border:none;border-radius:0 0 var(--radius) var(--radius);}

/* â•â• HURRICANE PAGE â•â• */
.hurricane-page{padding:20px 24px;max-width:1400px;margin:0 auto;}
.storm-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:12px;}
.storm-card{background:var(--card);border:1px solid rgba(234,88,12,0.2);border-radius:var(--radius);padding:18px;transition:var(--transition);}
.storm-card:hover{border-color:rgba(234,88,12,0.5);transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,0.3);}
.storm-cat{font-family:'Oswald',sans-serif;font-size:0.65rem;letter-spacing:3px;color:var(--dim);margin-bottom:6px;}
.storm-name{font-family:'Oswald',sans-serif;font-size:1.6rem;font-weight:700;color:#fff;margin-bottom:4px;}
.storm-winds{font-size:0.85rem;color:var(--orange);font-weight:600;}
.storm-loc{font-size:0.75rem;color:var(--dim);margin-top:4px;font-weight:300;}
.storm-track{margin-top:12px;font-size:0.72rem;color:var(--dim);line-height:1.6;}
.cat-badge{display:inline-block;padding:3px 10px;border-radius:4px;font-family:'Oswald',sans-serif;font-size:0.75rem;letter-spacing:2px;margin-bottom:8px;}
.cat-1{background:rgba(250,204,21,0.15);color:#fde047;border:1px solid rgba(250,204,21,0.25);}
.cat-2{background:rgba(251,146,60,0.15);color:#fb923c;border:1px solid rgba(251,146,60,0.25);}
.cat-3{background:rgba(239,68,68,0.15);color:#f87171;border:1px solid rgba(239,68,68,0.25);}
.cat-4{background:rgba(168,85,247,0.15);color:#c084fc;border:1px solid rgba(168,85,247,0.25);}
.cat-5{background:rgba(220,38,38,0.25);color:#fca5a5;border:1px solid rgba(220,38,38,0.4);}
.no-storms{text-align:center;padding:60px 20px;color:var(--dim);}
.no-storms-icon{font-size:3rem;margin-bottom:14px;}
.no-storms-t{font-family:'Oswald',sans-serif;font-size:1.2rem;letter-spacing:3px;color:rgba(255,255,255,0.2);margin-bottom:8px;}
.no-storms-s{font-size:0.8rem;}

/* Hurricane map embed */
.hurricane-map-wrap{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-top:16px;}
.hurricane-map-toolbar{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.hurricane-map-frame{width:100%;height:450px;border:none;}

/* â•â• ALERTS PAGE â•â• */
.alerts-page{padding:20px 24px;max-width:1400px;margin:0 auto;}
.alert-full-card{background:var(--card);border-radius:var(--radius);padding:20px 22px;margin-bottom:12px;transition:var(--transition);border-left:4px solid transparent;}
.alert-full-card:hover{transform:translateX(4px);}
.alert-extreme{border-left-color:#ef4444;border-color:rgba(239,68,68,0.2);}
.alert-severe{border-left-color:#f97316;border-color:rgba(249,115,22,0.2);}
.alert-moderate{border-left-color:#facc15;border-color:rgba(250,204,21,0.18);}
.alert-minor{border-left-color:#4ade80;border-color:rgba(74,222,128,0.18);}
.alert-full-head{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:8px;}
.alert-full-title{font-family:'Oswald',sans-serif;font-size:1.1rem;letter-spacing:1px;color:#fff;}
.alert-full-sev{font-family:'Oswald',sans-serif;font-size:0.65rem;letter-spacing:3px;padding:3px 10px;border-radius:3px;}
.sev-extreme{background:rgba(239,68,68,0.15);color:#fca5a5;}
.sev-severe{background:rgba(249,115,22,0.15);color:#fdba74;}
.sev-moderate{background:rgba(250,204,21,0.12);color:#fde047;}
.sev-minor{background:rgba(74,222,128,0.12);color:#86efac;}
.alert-full-area{font-size:0.72rem;color:var(--dim);margin-bottom:8px;}
.alert-full-body{font-size:0.8rem;color:#aabbd0;line-height:1.7;font-weight:300;}
.alert-full-times{display:flex;gap:20px;margin-top:10px;font-size:0.68rem;color:var(--dim);}

/* â•â• AIR QUALITY PAGE â•â• */
.aq-page{padding:20px 24px;max-width:1400px;margin:0 auto;}
.aq-hero{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:28px;display:grid;grid-template-columns:auto 1fr;gap:28px;align-items:center;margin-bottom:16px;}
@media(max-width:600px){.aq-hero{grid-template-columns:1fr;text-align:center;}}
.aq-circle{width:120px;height:120px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;border:4px solid;position:relative;flex-shrink:0;}
.aq-circle-num{font-family:'Oswald',sans-serif;font-size:2.2rem;font-weight:700;line-height:1;}
.aq-circle-lbl{font-size:0.6rem;letter-spacing:2px;margin-top:2px;}
.aq-details-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:16px;}
@media(max-width:500px){.aq-details-grid{grid-template-columns:repeat(2,1fr);}}
.aq-detail{background:rgba(0,0,0,0.2);border:1px solid rgba(66,165,245,0.08);border-radius:8px;padding:12px;text-align:center;}
.aq-detail-lbl{font-size:0.6rem;color:var(--dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.aq-detail-val{font-family:'Oswald',sans-serif;font-size:1.1rem;font-weight:600;color:#fff;}

/* â•â• VIDEO / BROADCAST PAGE â•â• */
.video-page{padding:20px 24px;max-width:1400px;margin:0 auto;}
.broadcast-hero{
  background:linear-gradient(135deg,rgba(10,25,50,0.9),rgba(5,12,22,0.95));
  border:1px solid var(--border);border-radius:var(--radius);
  padding:24px;margin-bottom:20px;
  display:grid;grid-template-columns:1fr auto;gap:20px;align-items:center;
}
@media(max-width:600px){.broadcast-hero{grid-template-columns:1fr;}}
.broadcast-title{font-family:'Oswald',sans-serif;font-size:1.6rem;font-weight:700;letter-spacing:2px;color:#fff;margin-bottom:6px;}
.broadcast-sub{font-size:0.78rem;color:var(--dim);font-weight:300;line-height:1.6;}
.go-live-btn{
  background:linear-gradient(135deg,#dc2626,#b91c1c);
  border:none;color:#fff;padding:14px 28px;border-radius:8px;
  font-family:'Oswald',sans-serif;font-weight:600;letter-spacing:3px;font-size:1rem;
  transition:var(--transition);white-space:nowrap;
  box-shadow:0 4px 20px rgba(220,38,38,0.35);
  display:flex;align-items:center;gap:10px;
}
.go-live-btn:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(220,38,38,0.5);}
.go-live-btn i{animation:livedot 1s ease-in-out infinite;}

/* Broadcast modal */
.broadcast-modal{position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:500;display:none;flex-direction:column;}
.broadcast-modal.open{display:flex;}
.bcast-header{background:rgba(4,9,15,0.98);border-bottom:1px solid rgba(220,38,38,0.3);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;}
.bcast-logo{font-family:'Oswald',sans-serif;font-size:1.1rem;letter-spacing:3px;color:#fff;}
.bcast-logo span{color:var(--sky);}
.bcast-controls{display:flex;align-items:center;gap:10px;}
.bcast-stop{background:rgba(220,38,38,0.15);border:1px solid rgba(220,38,38,0.4);color:#ef4444;padding:8px 16px;border-radius:5px;font-family:'Oswald',sans-serif;letter-spacing:2px;font-size:0.8rem;}
.bcast-stop:hover{background:rgba(220,38,38,0.3);}

/* Green screen viewport */
.bcast-viewport{flex:1;position:relative;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.bcast-canvas{position:absolute;inset:0;width:100%;height:100%;}
.bcast-video-hidden{position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;}

/* Broadcast overlays */
.bcast-overlay-top{position:absolute;top:0;left:0;right:0;z-index:10;pointer-events:none;}
.bcast-banner{background:linear-gradient(90deg,rgba(4,9,15,0.92),rgba(4,9,15,0.7),transparent);padding:10px 20px 10px 20px;display:flex;align-items:center;gap:14px;}
.bcast-channel-name{font-family:'Oswald',sans-serif;font-size:1rem;font-weight:700;letter-spacing:3px;color:#fff;}
.bcast-live-badge{display:flex;align-items:center;gap:6px;background:rgba(220,38,38,0.9);padding:3px 10px;border-radius:3px;font-family:'Oswald',sans-serif;font-size:0.7rem;letter-spacing:2px;color:#fff;}

.bcast-overlay-bottom{position:absolute;bottom:0;left:0;right:0;z-index:10;pointer-events:none;}
.bcast-weather-bar{background:linear-gradient(transparent,rgba(4,9,15,0.95));padding:16px 20px 10px;}
.bcast-city-line{font-family:'Oswald',sans-serif;font-size:0.65rem;letter-spacing:4px;color:var(--sky);margin-bottom:4px;}
.bcast-temp-line{font-family:'Oswald',sans-serif;font-size:1.8rem;font-weight:700;color:#fff;line-height:1;}
.bcast-cond-line{font-family:'Oswald',sans-serif;font-size:0.8rem;letter-spacing:2px;color:var(--dim);}

/* Green screen settings panel */
.bcast-settings{position:absolute;right:0;top:50px;bottom:44px;width:260px;background:rgba(4,9,15,0.96);border-left:1px solid var(--border);z-index:20;overflow-y:auto;padding:16px;display:none;}
.bcast-settings.open{display:block;}
.bcast-set-title{font-family:'Oswald',sans-serif;font-size:0.75rem;letter-spacing:3px;color:var(--dim);margin-bottom:14px;}
.bcast-set-row{margin-bottom:14px;}
.bcast-set-lbl{font-size:0.65rem;color:var(--dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.bcast-set-input{width:100%;background:rgba(10,25,50,0.6);border:1px solid var(--border);border-radius:5px;color:#fff;padding:8px 10px;font-size:0.85rem;outline:none;}
.bcast-set-input:focus{border-color:var(--sky);}
.bcast-set-slider{width:100%;accent-color:var(--sky);}
.bcast-bg-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:6px;}
.bcast-bg-btn{background:rgba(10,25,50,0.5);border:1px solid var(--border);color:var(--dim);padding:7px;border-radius:5px;font-size:0.7rem;letter-spacing:1px;font-family:'Oswald',sans-serif;transition:var(--transition);}
.bcast-bg-btn:hover,.bcast-bg-btn.on{background:rgba(66,165,245,0.15);border-color:var(--sky);color:var(--sky);}

.bcast-ticker-bar{height:32px;background:rgba(4,9,15,0.95);border-top:1px solid rgba(66,165,245,0.15);display:flex;align-items:center;overflow:hidden;flex-shrink:0;}
.bcast-ticker-lbl{flex-shrink:0;background:var(--gold);color:#04090f;font-family:'Oswald',sans-serif;font-weight:700;font-size:0.7rem;letter-spacing:2px;height:100%;display:flex;align-items:center;padding:0 12px;}
.bcast-ticker-scroll{overflow:hidden;flex:1;}
.bcast-ticker-inner{white-space:nowrap;animation:tickscroll 40s linear infinite;font-size:0.75rem;color:#99bbcc;letter-spacing:0.5px;}
@keyframes tickscroll{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}

/* Password gate */
.pw-gate{position:fixed;inset:0;background:rgba(4,9,15,0.98);z-index:600;display:flex;align-items:center;justify-content:center;display:none;}
.pw-gate.open{display:flex;}
.pw-box{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:36px;max-width:360px;width:90%;text-align:center;}
.pw-icon{font-size:2.5rem;margin-bottom:14px;}
.pw-title{font-family:'Oswald',sans-serif;font-size:1.4rem;letter-spacing:3px;color:#fff;margin-bottom:6px;}
.pw-sub{font-size:0.78rem;color:var(--dim);margin-bottom:22px;font-weight:300;}
.pw-input{width:100%;background:rgba(10,25,50,0.7);border:1px solid var(--border);border-radius:7px;color:#fff;padding:12px 16px;font-size:1rem;letter-spacing:4px;text-align:center;outline:none;margin-bottom:12px;}
.pw-input:focus{border-color:var(--sky);}
.pw-submit{width:100%;background:linear-gradient(135deg,var(--blue2),var(--blue));border:none;color:#fff;padding:12px;border-radius:7px;font-family:'Oswald',sans-serif;letter-spacing:3px;font-size:1rem;margin-bottom:8px;transition:var(--transition);}
.pw-submit:hover{transform:translateY(-1px);box-shadow:var(--glow-blue);}
.pw-cancel{background:transparent;border:none;color:var(--dim);font-size:0.8rem;letter-spacing:1px;}
.pw-cancel:hover{color:var(--text);}
.pw-err{color:#fca5a5;font-size:0.8rem;margin-top:8px;display:none;}
.pw-err.show{display:block;}
/* Change password */
.pw-change-hint{font-size:0.65rem;color:var(--dim);margin-top:10px;opacity:0.6;}

/* Video gallery */
.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:18px;}
.video-card{background:var(--card);border:1px solid rgba(66,165,245,0.1);border-radius:var(--radius);overflow:hidden;transition:var(--transition);}
.video-card:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(0,0,0,0.4),0 0 0 1px rgba(66,165,245,0.2);}
.video-thumb{width:100%;aspect-ratio:16/9;background:#071018;position:relative;overflow:hidden;cursor:pointer;}
.video-thumb img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s;}
.video-card:hover .video-thumb img{transform:scale(1.04);}
.video-thumb-placeholder{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;color:var(--dim);background:linear-gradient(135deg,#071018,#0a1628);}
.video-play-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;}
.video-thumb:hover .video-play-overlay{opacity:1;}
.play-circle{width:58px;height:58px;border-radius:50%;background:rgba(245,158,11,0.9);display:flex;align-items:center;justify-content:center;font-size:1.3rem;padding-left:4px;}
.video-body{padding:14px 16px;}
.video-tag-row{display:flex;align-items:center;gap:8px;margin-bottom:7px;}
.video-tag{font-family:'Oswald',sans-serif;font-size:0.62rem;letter-spacing:2px;padding:2px 8px;border-radius:3px;}
.tag-live{background:rgba(220,38,38,0.15);color:#fca5a5;border:1px solid rgba(220,38,38,0.25);}
.tag-report{background:rgba(66,165,245,0.12);color:var(--sky);border:1px solid rgba(66,165,245,0.2);}
.tag-clip{background:rgba(245,158,11,0.1);color:var(--gold);border:1px solid rgba(245,158,11,0.2);}
.tag-upload{background:rgba(74,222,128,0.1);color:#86efac;border:1px solid rgba(74,222,128,0.2);}
.video-date{font-size:0.62rem;color:var(--dim);margin-left:auto;}
.video-title{font-family:'Oswald',sans-serif;font-size:1.05rem;color:#fff;margin-bottom:5px;}
.video-desc{font-size:0.76rem;color:var(--dim);font-weight:300;line-height:1.5;margin-bottom:12px;}
.video-actions{display:flex;gap:8px;}
.v-act-btn{flex:1;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--dim);border-radius:5px;padding:7px;font-family:'Oswald',sans-serif;letter-spacing:1px;font-size:0.7rem;transition:var(--transition);}
.v-act-btn:hover{color:#fff;border-color:rgba(255,255,255,0.15);}
.v-act-btn.del:hover{color:#fca5a5;border-color:rgba(220,38,38,0.3);}

/* Add video form */
.add-video-btn{background:linear-gradient(135deg,var(--gold),var(--gold2));border:none;color:#04090f;padding:11px 22px;border-radius:6px;font-family:'Oswald',sans-serif;font-weight:700;letter-spacing:3px;font-size:0.9rem;transition:var(--transition);box-shadow:0 4px 15px rgba(245,158,11,0.25);}
.add-video-btn:hover{transform:translateY(-2px);box-shadow:0 6px 22px rgba(245,158,11,0.4);}
.video-form-wrap{background:var(--card);border:1px solid var(--border-gold);border-radius:var(--radius);padding:22px 26px;margin-bottom:20px;display:none;animation:pagein 0.3s ease;}
.video-form-wrap.open{display:block;}
.form-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
@media(max-width:600px){.form-grid-2{grid-template-columns:1fr;}}
.fg-full{grid-column:1/-1;}
.form-lbl{font-size:0.63rem;letter-spacing:2px;text-transform:uppercase;color:var(--dim);margin-bottom:6px;display:block;}
.form-inp,.form-sel,.form-ta{width:100%;background:rgba(10,25,50,0.6);border:1px solid var(--border);border-radius:5px;color:#fff;padding:10px 13px;font-size:0.88rem;outline:none;transition:border-color 0.2s;font-family:'Montserrat',sans-serif;}
.form-inp:focus,.form-sel:focus,.form-ta:focus{border-color:var(--sky);}
.form-sel option{background:#071018;}
.form-ta{resize:vertical;min-height:70px;}
.form-actions-row{display:flex;gap:10px;margin-top:14px;}
.form-save-btn{background:var(--blue2);border:none;color:#fff;padding:10px 22px;border-radius:5px;font-family:'Oswald',sans-serif;letter-spacing:3px;font-size:0.9rem;transition:var(--transition);}
.form-save-btn:hover{background:var(--blue);}
.form-cancel-btn{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);color:var(--dim);padding:10px 18px;border-radius:5px;font-family:'Oswald',sans-serif;letter-spacing:2px;font-size:0.85rem;transition:var(--transition);}
.form-cancel-btn:hover{color:#fff;}
.video-empty{text-align:center;padding:60px 20px;border:2px dashed rgba(66,165,245,0.12);border-radius:12px;display:none;}
.video-empty.show{display:block;}
.video-empty-icon{font-size:3rem;margin-bottom:12px;}
.video-empty-t{font-family:'Oswald',sans-serif;font-size:1.2rem;letter-spacing:3px;color:rgba(255,255,255,0.2);margin-bottom:8px;}
.video-empty-s{font-size:0.78rem;color:var(--dim);}

/* Video playback modal */
.video-modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:400;display:none;align-items:center;justify-content:center;padding:20px;}
.video-modal.open{display:flex;}
.video-modal-inner{background:#04090f;border:1px solid var(--border);border-radius:12px;max-width:900px;width:100%;overflow:hidden;position:relative;}
.video-modal-close{position:absolute;top:12px;right:14px;background:rgba(255,255,255,0.07);border:none;color:#fff;width:32px;height:32px;border-radius:50%;font-size:1rem;z-index:2;transition:var(--transition);}
.video-modal-close:hover{background:rgba(220,38,38,0.4);}
.video-modal-frame{width:100%;aspect-ratio:16/9;}
.video-modal-frame iframe,.video-modal-frame video{width:100%;height:100%;border:none;display:block;}

/* â•â• NEWS / BLOG PAGE â•â• */
.news-page{padding:20px 24px;max-width:1400px;margin:0 auto;}
.news-grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;}
@media(max-width:800px){.news-grid{grid-template-columns:1fr;}}
.news-feed{display:flex;flex-direction:column;gap:14px;}
.news-card{background:var(--card);border:1px solid rgba(66,165,245,0.1);border-radius:var(--radius);padding:18px 20px;transition:var(--transition);display:flex;gap:16px;align-items:flex-start;}
.news-card:hover{border-color:rgba(66,165,245,0.25);transform:translateX(4px);}
.news-cat-icon{font-size:1.8rem;flex-shrink:0;margin-top:2px;}
.news-content{}
.news-cat-tag{font-family:'Oswald',sans-serif;font-size:0.62rem;letter-spacing:3px;color:var(--sky);text-transform:uppercase;margin-bottom:5px;}
.news-headline{font-family:'Oswald',sans-serif;font-size:1.05rem;font-weight:600;color:#fff;margin-bottom:6px;line-height:1.3;}
.news-snippet{font-size:0.78rem;color:var(--dim);font-weight:300;line-height:1.6;margin-bottom:8px;}
.news-meta{font-size:0.62rem;color:var(--dim);opacity:0.7;display:flex;gap:14px;}
.news-sidebar{display:flex;flex-direction:column;gap:14px;}
.trending-box{background:var(--card);border:1px solid var(--border-gold);border-radius:var(--radius);padding:16px;}
.trending-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid rgba(66,165,245,0.07);align-items:flex-start;}
.trending-item:last-child{border-bottom:none;}
.trending-num{font-family:'Oswald',sans-serif;font-size:1.2rem;font-weight:700;color:rgba(66,165,245,0.3);min-width:24px;line-height:1.2;}
.trending-text{font-size:0.78rem;color:var(--dim);font-weight:300;line-height:1.5;}

/* â•â• TICKER BAR â•â• */
.site-ticker{
  background:rgba(4,9,15,0.98);
  border-top:1px solid rgba(66,165,245,0.12);
  height:34px;display:flex;align-items:center;overflow:hidden;flex-shrink:0;
  position:sticky;bottom:0;z-index:50;
}
.ticker-lbl{flex-shrink:0;background:var(--blue2);color:#fff;font-family:'Oswald',sans-serif;font-weight:700;font-size:0.72rem;letter-spacing:2px;height:100%;display:flex;align-items:center;padding:0 14px;}
.ticker-scroll-wrap{overflow:hidden;flex:1;}
.ticker-text{white-space:nowrap;animation:tickscroll 50s linear infinite;font-size:0.75rem;color:#8aaec8;letter-spacing:0.5px;font-weight:300;}
.t-sep{display:inline-block;margin:0 20px;color:var(--gold);font-weight:700;}

/* â•â• LOADING â•â• */
.site-loader{position:fixed;inset:0;background:rgba(4,9,15,0.96);z-index:900;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;transition:opacity 0.5s;}
.site-loader.gone{opacity:0;pointer-events:none;}
.loader-ring{width:54px;height:54px;border:3px solid rgba(66,165,245,0.12);border-top-color:var(--sky);border-radius:50%;animation:spin 0.8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.loader-text{font-family:'Oswald',sans-serif;font-size:0.85rem;letter-spacing:5px;color:var(--dim);text-transform:uppercase;}
.loader-logo{font-family:'Oswald',sans-serif;font-size:1.3rem;letter-spacing:4px;color:#fff;font-weight:700;}
.loader-logo span{color:var(--sky);}

/* â•â• RESPONSIVE â•â• */
@media(max-width:900px){
  .dashboard{grid-template-columns:1fr;padding:14px 16px;}
  .dash-sidebar{flex-direction:row;flex-wrap:wrap;}
  .dash-sidebar>*{flex:1;min-width:200px;}
  .section-wrap{padding:0 16px 16px;}
  .radar-page,.hurricane-page,.alerts-page,.aq-page,.video-page,.news-page{padding:14px 16px;}
  .header-top{padding:10px 16px;}
  .search-strip{padding:10px 16px;}
  .main-nav{padding:0 16px;}
}
@media(max-width:500px){
  .forecast7{grid-template-columns:repeat(4,1fr);}
  .logo-name{font-size:1.1rem;}
  .logo-tagline{display:none;}
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .broadcast-hero{padding:16px;}
}
</style>
</head>
<body>

<!-- BG -->
<div class="bg-scene">
  <div class="bg-grad"></div>
  <div class="bg-cloud" style="width:130%;height:160px;top:2%;animation-duration:80s;left:-15%;"></div>
  <div class="bg-cloud" style="width:120%;height:110px;top:30%;animation-duration:100s;animation-delay:-40s;opacity:0.6;left:-10%;"></div>
  <div class="bg-cloud" style="width:140%;height:190px;top:60%;animation-duration:90s;animation-delay:-20s;opacity:0.35;left:-20%;"></div>
  <div class="starfield" id="starfield"></div>
  <div class="rain-wrap" id="rainWrap"></div>
  <div class="snow-wrap" id="snowWrap"></div>
  <div class="lightning-flash" id="lflash"></div>
</div>

<!-- LOADER -->
<div class="site-loader" id="siteLoader">
  <div class="loader-logo">Smokey's <span>Weather Network</span></div>
  <div class="loader-ring"></div>
  <div class="loader-text">Loading Weather Dataâ€¦</div>
</div>

<!-- PASSWORD GATE -->
<div class="pw-gate" id="pwGate">
  <div class="pw-box">
    <div class="pw-icon">ğŸ“¡</div>
    <div class="pw-title">BROADCASTER LOGIN</div>
    <div class="pw-sub">Enter your broadcast password to go live on Smokey's Weather Network</div>
    <input type="password" class="pw-input" id="pwInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
    <button class="pw-submit" onclick="checkPassword()">ENTER STUDIO</button>
    <div class="pw-err" id="pwErr">Wrong password. Try again.</div>
    <button class="pw-cancel" onclick="closePwGate()">Cancel</button>
    <div class="pw-change-hint">Default password: <strong>smokey123</strong> â€” change it in the broadcast panel</div>
  </div>
</div>

<!-- VIDEO MODAL -->
<div class="video-modal" id="videoModal">
  <div class="video-modal-inner">
    <button class="video-modal-close" onclick="closeVideoModal()">âœ•</button>
    <div class="video-modal-frame" id="videoModalFrame"></div>
  </div>
</div>

<!-- BROADCAST MODAL -->
<div class="broadcast-modal" id="broadcastModal">
  <!-- Header -->
  <div class="bcast-header">
    <div class="bcast-logo">Smokey's <span>Weather Network</span> â€” <span style="color:#ef4444;">LIVE BROADCAST</span></div>
    <div class="bcast-controls">
      <button class="bcast-stop" onclick="openSettings()"><i class="fas fa-cog"></i> Settings</button>
      <button class="bcast-stop" onclick="stopBroadcast()"><i class="fas fa-stop"></i> End Broadcast</button>
    </div>
  </div>
  <!-- Viewport -->
  <div class="bcast-viewport">
    <video id="bcastVideo" class="bcast-video-hidden" autoplay playsinline muted></video>
    <canvas id="bcastCanvas" class="bcast-canvas"></canvas>

    <!-- Top overlay -->
    <div class="bcast-overlay-top">
      <div class="bcast-banner">
        <div class="bcast-channel-name">SMOKEY'S WEATHER NETWORK</div>
        <div class="bcast-live-badge"><span style="width:7px;height:7px;border-radius:50%;background:#fff;display:inline-block;animation:livedot 1s infinite;"></span> LIVE</div>
      </div>
    </div>

    <!-- Bottom overlay -->
    <div class="bcast-overlay-bottom">
      <div class="bcast-weather-bar">
        <div class="bcast-city-line" id="bcastCity">ğŸ“ ---</div>
        <div class="bcast-temp-line" id="bcastTemp">--Â°F</div>
        <div class="bcast-cond-line" id="bcastCond">Loadingâ€¦</div>
      </div>
    </div>

    <!-- Settings panel -->
    <div class="bcast-settings" id="bcastSettings">
      <div class="bcast-set-title">âš™ï¸ BROADCAST SETTINGS</div>

      <div class="bcast-set-row">
        <div class="bcast-set-lbl">Green Screen Color</div>
        <input type="color" class="bcast-set-input" id="chromaColor" value="#00ff00" style="height:40px;padding:4px;" oninput="updateChroma()"/>
      </div>

      <div class="bcast-set-row">
        <div class="bcast-set-lbl">Sensitivity (lower = tighter)</div>
        <input type="range" class="bcast-set-slider" id="chromaThresh" min="20" max="120" value="60" oninput="updateChroma()"/>
      </div>

      <div class="bcast-set-row">
        <div class="bcast-set-lbl">Smoothing</div>
        <input type="range" class="bcast-set-slider" id="chromaSmooth" min="0" max="30" value="10" oninput="updateChroma()"/>
      </div>

      <div class="bcast-set-row">
        <div class="bcast-set-lbl">Virtual Background</div>
        <div class="bcast-bg-grid">
          <button class="bcast-bg-btn on" onclick="setBg('radar')" id="bgRadar">ğŸ“¡ Radar</button>
          <button class="bcast-bg-btn" onclick="setBg('storm')" id="bgStorm">â›ˆï¸ Storm</button>
          <button class="bcast-bg-btn" onclick="setBg('map')" id="bgMap">ğŸ—ºï¸ Map</button>
          <button class="bcast-bg-btn" onclick="setBg('clear')" id="bgClear">â˜€ï¸ Clear</button>
        </div>
      </div>

      <div class="bcast-set-row">
        <div class="bcast-set-lbl">Change Broadcast Password</div>
        <input type="password" class="bcast-set-input" id="newPwInput" placeholder="New passwordâ€¦"/>
        <button style="margin-top:8px;width:100%;background:rgba(66,165,245,0.15);border:1px solid var(--border);color:var(--sky);padding:8px;border-radius:5px;font-family:'Oswald',sans-serif;letter-spacing:2px;font-size:0.75rem;" onclick="changePassword()">CHANGE PASSWORD</button>
        <div id="pwChangeMsg" style="font-size:0.7rem;color:#86efac;margin-top:6px;display:none;">âœ“ Password updated!</div>
      </div>
    </div>

    <!-- BG canvas (animated weather backgrounds) -->
    <canvas id="bgCanvas" style="position:absolute;inset:0;width:100%;height:100%;z-index:0;"></canvas>
  </div>

  <!-- Ticker -->
  <div class="bcast-ticker-bar">
    <div class="bcast-ticker-lbl">âš¡ SWN</div>
    <div class="bcast-ticker-scroll">
      <div class="bcast-ticker-inner" id="bcastTickerInner">Smokey's Weather Network â€” Live Broadcast</div>
    </div>
  </div>
</div>

<!-- MAIN SITE -->
<div style="display:flex;flex-direction:column;min-height:100vh;position:relative;z-index:1;">

<!-- HEADER -->
<header class="site-header">
  <div class="header-top">
    <div class="logo">
      <div class="logo-mark">ğŸŒ©ï¸</div>
      <div class="logo-text-wrap">
        <div class="logo-name">Smokey's <span>Weather</span> Network</div>
        <div class="logo-tagline">Professional Forecast Â· Live & Accurate</div>
      </div>
    </div>
    <div class="header-center">
      <div class="live-badge"><div class="live-dot"></div>LIVE DATA</div>
      <div class="alert-badge" id="alertBadge"><i class="fas fa-triangle-exclamation"></i><span id="alertBadgeText">ALERTS ACTIVE</span></div>
    </div>
    <div class="header-clock">
      <div class="clock-time" id="clockTime">--:--:--</div>
      <div class="clock-date" id="clockDate">---</div>
    </div>
  </div>
  <nav class="main-nav">
    <button class="nav-btn active" onclick="showPage('dashboard',this)"><i class="fas fa-house"></i>Dashboard</button>
    <button class="nav-btn" onclick="showPage('radar',this)"><i class="fas fa-satellite-dish"></i>Radar</button>
    <button class="nav-btn" onclick="showPage('forecast',this)"><i class="fas fa-calendar-days"></i>Forecast</button>
    <button class="nav-btn" onclick="showPage('alerts',this)"><i class="fas fa-triangle-exclamation"></i>Alerts</button>
    <button class="nav-btn" onclick="showPage('hurricane',this)"><i class="fas fa-hurricane"></i>Hurricane</button>
    <button class="nav-btn" onclick="showPage('airquality',this)"><i class="fas fa-wind"></i>Air Quality</button>
    <button class="nav-btn" onclick="showPage('videos',this)"><i class="fas fa-video"></i>Videos</button>
    <button class="nav-btn" onclick="showPage('news',this)"><i class="fas fa-newspaper"></i>News</button>
  </nav>
</header>

<!-- SEARCH -->
<div class="search-strip">
  <div class="search-box">
    <input type="text" id="citySearch" placeholder="Search city, state or countryâ€¦"/>
    <button onclick="doSearch()">SEARCH</button>
  </div>
  <button class="locate-btn" onclick="doLocate()" title="Use my location"><i class="fas fa-location-dot"></i></button>
  <div class="unit-toggle">
    <button class="unit-btn on" id="btnF" onclick="setUnit('F')">Â°F</button>
    <button class="unit-btn" id="btnC" onclick="setUnit('C')">Â°C</button>
  </div>
  <div class="err-msg" id="errMsg">Location not found. Please try another search.</div>
</div>

<!-- â•â• DASHBOARD PAGE â•â• -->
<div class="page active" id="page-dashboard">
  <div class="dashboard">
    <!-- Hero -->
    <div class="conditions-hero">
      <div class="city-row">
        <span class="city-pin"><i class="fas fa-location-dot"></i></span>
        <span class="city-name" id="heroCity">---</span>
        <span class="city-region" id="heroRegion"></span>
      </div>
      <div class="data-attr" id="heroAttr">Connecting to Smokey's Weather Network data streamâ€¦</div>
      <div class="main-temp-row">
        <div class="wx-icon" id="heroIcon">ğŸŒ¡ï¸</div>
        <div class="temp-big" id="heroTemp">--</div>
        <div class="temp-unit-lbl" id="heroUnit">Â°F</div>
      </div>
      <div class="condition-lbl" id="heroCond">Loadingâ€¦</div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-lbl">Humidity</div><div class="stat-val"><span class="stat-icon"><i class="fas fa-droplet"></i></span><span id="sHumidity">--%</span></div></div>
        <div class="stat-card"><div class="stat-lbl">Wind</div><div class="stat-val"><span class="stat-icon"><i class="fas fa-wind"></i></span><span id="sWind">--</span></div></div>
        <div class="stat-card"><div class="stat-lbl">Visibility</div><div class="stat-val"><span class="stat-icon"><i class="fas fa-eye"></i></span><span id="sVis">--</span></div></div>
        <div class="stat-card"><div class="stat-lbl">Pressure</div><div class="stat-val"><span class="stat-icon"><i class="fas fa-gauge"></i></span><span id="sPressure">--</span></div></div>
        <div class="stat-card"><div class="stat-lbl">Dew Point</div><div class="stat-val" id="sDew">--</div></div>
        <div class="stat-card"><div class="stat-lbl">Cloud Cover</div><div class="stat-val" id="sCloud">--</div></div>
        <div class="stat-card"><div class="stat-lbl">UV Index</div><div class="stat-val" id="sUV">--</div></div>
        <div class="stat-card"><div class="stat-lbl">Precip</div><div class="stat-val" id="sPrecip">--</div></div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="dash-sidebar">
      <div class="widget">
        <div class="widget-title"><i class="fas fa-thermometer-half"></i> Feels Like</div>
        <div class="feels-num" id="wFeels">--Â°</div>
        <div class="feels-desc" id="wFeelsDesc">---</div>
        <div class="prog"><div class="prog-fill prog-blue" id="wFeelsBar" style="width:50%;"></div></div>
      </div>
      <div class="widget">
        <div class="widget-title"><i class="fas fa-sun"></i> Sun Schedule</div>
        <div class="sun-arc">
          <svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="sunarcgrad" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#f59e0b" stop-opacity="0.4"/>
                <stop offset="50%" stop-color="#fde047" stop-opacity="0.8"/>
                <stop offset="100%" stop-color="#f97316" stop-opacity="0.4"/>
              </linearGradient>
            </defs>
            <path d="M 10 55 Q 100 5 190 55" fill="none" stroke="url(#sunarcgrad)" stroke-width="1.5" stroke-dasharray="4 4" opacity="0.6"/>
            <circle id="sunDot" cx="100" cy="26" r="7" fill="#fde047" opacity="0.9">
              <animate attributeName="opacity" values="0.9;0.5;0.9" dur="2s" repeatCount="indefinite"/>
            </circle>
            <circle id="sunGlow" cx="100" cy="26" r="13" fill="#fde047" opacity="0.1"/>
          </svg>
        </div>
        <div class="sun-times">
          <div class="sun-item"><div class="sun-icon">ğŸŒ…</div><div class="sun-time-val" id="sunRise">--:--</div><div class="sun-time-lbl">RISE</div></div>
          <div class="sun-item"><div class="sun-icon">ğŸŒ‡</div><div class="sun-time-val" id="sunSet">--:--</div><div class="sun-time-lbl">SET</div></div>
        </div>
      </div>
      <div class="widget">
        <div class="widget-title"><i class="fas fa-wind"></i> Wind</div>
        <div class="feels-num" id="wWindBig">--</div>
        <div class="feels-desc" id="wWindDir">Direction: ---</div>
        <div class="feels-desc" id="wWindGust" style="color:#93c5fd;margin-top:4px;">Gusts: --</div>
        <div class="prog" style="margin-top:10px;"><div class="prog-fill prog-teal" id="wWindBar" style="width:15%;"></div></div>
      </div>
      <div class="widget" style="background:rgba(10,30,15,0.6);border-color:rgba(22,163,74,0.2);">
        <div class="widget-title" style="color:var(--dim);"><i class="fas fa-leaf"></i> Air Quality</div>
        <div class="aqi-num" id="wAQI" style="color:#4ade80;">--</div>
        <div class="aqi-label aqi-good" id="wAQILabel">Loadingâ€¦</div>
        <div class="prog" style="margin-top:12px;"><div class="prog-fill" id="wAQIBar" style="width:20%;background:linear-gradient(90deg,#16a34a,#4ade80);"></div></div>
      </div>
      <div class="widget alert-widget" id="alertWidget">
        <div class="widget-title"><i class="fas fa-triangle-exclamation" style="color:#ef4444;"></i> Weather Alerts</div>
        <div class="alert-count" id="alertCount">0</div>
        <div class="alert-list" id="alertList"></div>
      </div>
    </div>
  </div>

  <!-- Hourly -->
  <div class="section-wrap">
    <div class="section-head"><i class="fas fa-clock"></i> Hourly Forecast</div>
    <div class="hourly-scroll" id="hourlyScroll"></div>
  </div>

  <!-- 7-day -->
  <div class="section-wrap">
    <div class="section-head"><i class="fas fa-calendar-week"></i> 7-Day Forecast</div>
    <div class="forecast7" id="forecast7"></div>
  </div>
</div>

<!-- â•â• RADAR PAGE â•â• -->
<div class="page" id="page-radar">
  <div class="radar-page">
    <div class="section-head"><i class="fas fa-satellite-dish"></i> Live Radar</div>
    <div class="radar-container">
      <div class="radar-toolbar">
        <span class="radar-title">RADAR TYPE:</span>
        <button class="radar-type-btn on" onclick="switchRadar('rain',this)">ğŸŒ§ï¸ Precipitation</button>
        <button class="radar-type-btn" onclick="switchRadar('wind',this)">ğŸ’¨ Wind</button>
        <button class="radar-type-btn" onclick="switchRadar('temp',this)">ğŸŒ¡ï¸ Temperature</button>
        <button class="radar-type-btn" onclick="switchRadar('cloud',this)">â˜ï¸ Clouds</button>
      </div>
      <iframe class="radar-frame" id="radarFrame"
        src="https://embed.windy.com/embed2.html?lat=39&lon=-98&detailLat=39&detailLon=-98&width=100%&height=520&zoom=4&level=surface&overlay=rain&product=ecmwf&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1"
        frameborder="0" allow="geolocation">
      </iframe>
    </div>
  </div>
</div>

<!-- â•â• FORECAST PAGE â•â• -->
<div class="page" id="page-forecast">
  <div style="padding:20px 24px;max-width:1400px;margin:0 auto;">
    <div class="section-head"><i class="fas fa-clock"></i> 48-Hour Hourly Forecast</div>
    <div class="hourly-scroll" id="hourlyScroll2" style="margin-bottom:24px;"></div>
    <div class="section-head"><i class="fas fa-calendar-week"></i> 7-Day Forecast</div>
    <div class="forecast7" id="forecast7b"></div>
  </div>
</div>

<!-- â•â• ALERTS PAGE â•â• -->
<div class="page" id="page-alerts">
  <div class="alerts-page">
    <div class="section-head"><i class="fas fa-triangle-exclamation"></i> Active Weather Alerts</div>
    <div id="alertsContainer">
      <div style="text-align:center;padding:50px;color:var(--dim);">
        <div style="font-size:2.5rem;margin-bottom:12px;">âœ…</div>
        <div style="font-family:'Oswald',sans-serif;font-size:1.1rem;letter-spacing:3px;color:rgba(255,255,255,0.2);">NO ACTIVE ALERTS</div>
        <div style="font-size:0.8rem;margin-top:8px;">Search a location to check for weather alerts</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â• HURRICANE PAGE â•â• -->
<div class="page" id="page-hurricane">
  <div class="hurricane-page">
    <div class="section-head"><i class="fas fa-hurricane"></i> Hurricane & Tropical Storm Tracker</div>
    <div class="hurricane-map-wrap">
      <div class="hurricane-map-toolbar">
        <span style="font-family:'Oswald',sans-serif;font-size:0.75rem;letter-spacing:2px;color:var(--dim);">ğŸŒ€ ACTIVE STORM TRACKS â€” POWERED BY WINDY</span>
      </div>
      <iframe class="hurricane-map-frame"
        src="https://embed.windy.com/embed2.html?lat=25&lon=-70&detailLat=25&detailLon=-70&width=100%&height=450&zoom=3&level=surface&overlay=wind&product=ecmwf&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1"
        frameborder="0">
      </iframe>
    </div>
    <div style="margin-top:20px;">
      <div class="section-head"><i class="fas fa-list"></i> Active Systems</div>
      <div id="stormContainer">
        <div class="no-storms">
          <div class="no-storms-icon">ğŸŒŠ</div>
          <div class="no-storms-t">NO ACTIVE TROPICAL SYSTEMS</div>
          <div class="no-storms-s">The Atlantic and Pacific basins are currently quiet. Check back during hurricane season (Juneâ€“November).</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â• AIR QUALITY PAGE â•â• -->
<div class="page" id="page-airquality">
  <div class="aq-page">
    <div class="section-head"><i class="fas fa-leaf"></i> Air Quality Index</div>
    <div class="aq-hero">
      <div class="aq-circle" id="aqCircle" style="border-color:#4ade80;color:#4ade80;">
        <div class="aq-circle-num" id="aqNum">--</div>
        <div class="aq-circle-lbl">AQI</div>
      </div>
      <div>
        <div style="font-family:'Oswald',sans-serif;font-size:1.4rem;font-weight:600;color:#fff;margin-bottom:4px;" id="aqStatus">Search a location</div>
        <div style="font-size:0.8rem;color:var(--dim);font-weight:300;line-height:1.6;" id="aqDesc">Air quality information will appear here once you search for a location.</div>
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;" id="aqBadges"></div>
      </div>
    </div>
    <div class="aq-details-grid" id="aqGrid">
      <div class="aq-detail"><div class="aq-detail-lbl">PM2.5</div><div class="aq-detail-val" id="aqPM25">-- Î¼g/mÂ³</div></div>
      <div class="aq-detail"><div class="aq-detail-lbl">PM10</div><div class="aq-detail-val" id="aqPM10">-- Î¼g/mÂ³</div></div>
      <div class="aq-detail"><div class="aq-detail-lbl">UV Index</div><div class="aq-detail-val" id="aqUV">--</div></div>
      <div class="aq-detail"><div class="aq-detail-lbl">Carbon Monoxide</div><div class="aq-detail-val" id="aqCO">-- ppb</div></div>
      <div class="aq-detail"><div class="aq-detail-lbl">Nitrogen Dioxide</div><div class="aq-detail-val" id="aqNO2">-- ppb</div></div>
      <div class="aq-detail"><div class="aq-detail-lbl">Ozone</div><div class="aq-detail-val" id="aqO3">-- ppb</div></div>
    </div>
  </div>
</div>

<!-- â•â• VIDEOS PAGE â•â• -->
<div class="page" id="page-videos">
  <div class="video-page">
    <div class="broadcast-hero">
      <div>
        <div class="broadcast-title">ğŸ“¡ Broadcast Studio</div>
        <div class="broadcast-sub">Go live with your green screen setup. Your camera feed with green screen removal broadcasts directly on Smokey's Weather Network with real weather data overlays.</div>
      </div>
      <button class="go-live-btn" onclick="openPwGate()"><i class="fas fa-circle" style="color:#ef4444;font-size:0.7rem;"></i> GO LIVE</button>
    </div>

    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;">
      <div class="section-head" style="margin-bottom:0;flex:1;min-width:200px;"><i class="fas fa-film"></i> Video Library</div>
      <button class="add-video-btn" onclick="toggleVideoForm()"><i class="fas fa-plus"></i> ADD VIDEO</button>
    </div>

    <div class="video-form-wrap" id="videoFormWrap">
      <div style="font-family:'Oswald',sans-serif;font-size:1rem;letter-spacing:3px;color:var(--gold);margin-bottom:16px;">ADD NEW VIDEO</div>
      <div class="form-grid-2">
        <div><label class="form-lbl">Title *</label><input class="form-inp" id="vTitle" placeholder="e.g. Storm Front Moving In from the West"/></div>
        <div><label class="form-lbl">Category</label>
          <select class="form-sel" id="vCat">
            <option value="report">Weather Report</option>
            <option value="live">Live Broadcast</option>
            <option value="clip">Field Clip</option>
            <option value="upload">Uploaded Video</option>
          </select>
        </div>
        <div class="fg-full"><label class="form-lbl">YouTube / Video URL</label><input class="form-inp" id="vURL" placeholder="https://youtube.com/watch?v=..."/></div>
        <div class="fg-full"><label class="form-lbl">Or Upload Video File</label><input type="file" class="form-inp" id="vFile" accept="video/*" style="padding:8px;"/></div>
        <div class="fg-full"><label class="form-lbl">Description</label><textarea class="form-ta" id="vDesc" placeholder="Brief description of this broadcast segmentâ€¦"></textarea></div>
      </div>
      <div class="form-actions-row">
        <button class="form-save-btn" onclick="saveVideo()">SAVE VIDEO</button>
        <button class="form-cancel-btn" onclick="toggleVideoForm()">CANCEL</button>
      </div>
    </div>

    <div class="video-grid" id="videoGrid"></div>
    <div class="video-empty" id="videoEmpty">
      <div class="video-empty-icon">ğŸ“¹</div>
      <div class="video-empty-t">No Videos Yet</div>
      <div class="video-empty-s">Click "Add Video" to post your first forecast or go live to start broadcasting</div>
    </div>
  </div>
</div>

<!-- â•â• NEWS PAGE â•â• -->
<div class="page" id="page-news">
  <div class="news-page">
    <div class="section-head"><i class="fas fa-newspaper"></i> Weather News & Blog</div>
    <div class="news-grid">
      <div class="news-feed" id="newsFeed"></div>
      <div class="news-sidebar">
        <div class="trending-box">
          <div class="widget-title"><i class="fas fa-fire"></i> Trending Topics</div>
          <div id="trendingList"></div>
        </div>
        <div class="widget">
          <div class="widget-title"><i class="fas fa-rss"></i> Subscribe</div>
          <div style="font-size:0.78rem;color:var(--dim);margin-bottom:12px;font-weight:300;line-height:1.6;">Get Smokey's Weather Network alerts and updates delivered to you.</div>
          <input class="form-inp" placeholder="Your email addressâ€¦" style="margin-bottom:8px;"/>
          <button style="width:100%;background:var(--blue2);border:none;color:#fff;padding:10px;border-radius:5px;font-family:'Oswald',sans-serif;letter-spacing:3px;font-size:0.85rem;">SUBSCRIBE</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TICKER -->
<div class="site-ticker">
  <div class="ticker-lbl"><i class="fas fa-bolt"></i>&nbsp;SWN</div>
  <div class="ticker-scroll-wrap">
    <div class="ticker-text" id="tickerText">Smokey's Weather Network â€” Loading live dataâ€¦</div>
  </div>
</div>

</div><!-- end main site -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   SMOKEY'S WEATHER NETWORK â€” JS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ STARS â”€â”€
(function(){
  const sf=document.getElementById('starfield');
  for(let i=0;i<120;i++){
    const s=document.createElement('div');
    const sz=Math.random()*2+0.4;
    s.className='star';
    s.style.cssText=`width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${(Math.random()*4+1).toFixed(1)}s;--lo:${(Math.random()*0.15+0.03).toFixed(2)};--hi:${(Math.random()*0.5+0.15).toFixed(2)};`;
    sf.appendChild(s);
  }
})();

// â”€â”€ STATE â”€â”€
let unit='F', wxData=null, currentCity='', currentLat=0, currentLon=0;
let broadcastPw = localStorage.getItem('swn_pw')||'smokey123';
let videos = JSON.parse(localStorage.getItem('swn_videos')||'[]');
let chromaR=0,chromaG=255,chromaB=0,chromaThresh=60,chromaSmooth=10;
let broadcastStream=null, broadcastActive=false, bgMode='radar';
let animFrameId=null;

// WMO weather codes
const WMO={
  0:['Clear Sky','â˜€ï¸'],1:['Mainly Clear','ğŸŒ¤ï¸'],2:['Partly Cloudy','â›…'],3:['Overcast','â˜ï¸'],
  45:['Foggy','ğŸŒ«ï¸'],48:['Freezing Fog','ğŸŒ«ï¸'],
  51:['Light Drizzle','ğŸŒ¦ï¸'],53:['Drizzle','ğŸŒ¦ï¸'],55:['Heavy Drizzle','ğŸŒ§ï¸'],
  61:['Light Rain','ğŸŒ§ï¸'],63:['Rain','ğŸŒ§ï¸'],65:['Heavy Rain','ğŸŒ§ï¸'],
  71:['Light Snow','ğŸŒ¨ï¸'],73:['Snow','â„ï¸'],75:['Heavy Snow','â„ï¸'],77:['Snow Grains','ğŸŒ¨ï¸'],
  80:['Light Showers','ğŸŒ¦ï¸'],81:['Showers','ğŸŒ§ï¸'],82:['Heavy Showers','â›ˆï¸'],
  85:['Snow Showers','ğŸŒ¨ï¸'],86:['Heavy Snow Showers','â„ï¸'],
  95:['Thunderstorm','â›ˆï¸'],96:['T-storm w/ Hail','â›ˆï¸'],99:['Severe Thunderstorm','ğŸŒªï¸']
};

// â”€â”€ CLOCK â”€â”€
function updateClock(){
  const n=new Date();
  document.getElementById('clockTime').textContent=n.toLocaleTimeString('en-US',{hour12:true});
  document.getElementById('clockDate').textContent=n.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
}
updateClock();setInterval(updateClock,1000);

// â”€â”€ PAGE NAV â”€â”€
function showPage(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  btn.classList.add('active');
}

// â”€â”€ UNIT â”€â”€
function setUnit(u){
  unit=u;
  document.getElementById('btnF').classList.toggle('on',u==='F');
  document.getElementById('btnC').classList.toggle('on',u==='C');
  if(wxData)renderWeather(wxData);
}
const toF=c=>(c*9/5)+32;
const dT=c=>unit==='F'?Math.round(toF(c)):Math.round(c);
const tStr=c=>`${dT(c)}Â°${unit}`;
const windStr=v=>unit==='F'?`${Math.round(v)} mph`:`${Math.round(v*1.609)} km/h`;

// â”€â”€ WIND DIRECTION â”€â”€
function wDir(deg){return['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'][Math.round(deg/22.5)%16];}

// â”€â”€ FORMAT TIME â”€â”€
function fmtTime(iso){if(!iso)return'--:--';return new Date(iso).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});}
function fmtHour(iso){if(!iso)return'--';const d=new Date(iso);const h=d.getHours();return h===0?'12 AM':h<12?`${h} AM`:h===12?'12 PM':`${h-12} PM`;}

// â”€â”€ WEATHER EFFECTS â”€â”€
function buildRain(n){const c=document.getElementById('rainWrap');c.innerHTML='';for(let i=0;i<n;i++){const d=document.createElement('div');const h=Math.random()*60+20;d.className='rdrop';d.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*-80}px;height:${h}px;animation-duration:${(Math.random()*0.5+0.55).toFixed(2)}s;animation-delay:${(Math.random()*3).toFixed(2)}s;`;c.appendChild(d);}}
function buildSnow(n){const c=document.getElementById('snowWrap');c.innerHTML='';for(let i=0;i<n;i++){const d=document.createElement('div');const sz=Math.random()*4+2;d.className='snowflake';d.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*-40}px;width:${sz}px;height:${sz}px;animation-duration:${(Math.random()*5+4).toFixed(1)}s;animation-delay:${(Math.random()*6).toFixed(1)}s;`;c.appendChild(d);}}
function applyFX(code){
  const r=document.getElementById('rainWrap'),s=document.getElementById('snowWrap'),l=document.getElementById('lflash');
  r.style.opacity='0';s.style.opacity='0';clearInterval(window._li);
  if([51,53,55,61,63,65,80,81,82,95,96,99].includes(code)){buildRain([95,96,99].includes(code)?90:55);r.style.opacity=[95,96,99].includes(code)?'0.75':'0.55';}
  if([71,73,75,77,85,86].includes(code)){buildSnow(45);s.style.opacity='0.85';}
  if([95,96,99].includes(code)){window._li=setInterval(()=>{if(Math.random()>0.65){l.style.opacity='1';setTimeout(()=>l.style.opacity='0',70+Math.random()*130);}},2200);}
}

// â”€â”€ SUN ARC â”€â”€
function updateSunArc(rISO,sISO){
  const now=Date.now(),r=new Date(rISO).getTime(),s=new Date(sISO).getTime();
  const t=Math.max(0,Math.min(1,(now-r)/(s-r)));
  const x=(1-t)*(1-t)*10+2*(1-t)*t*100+t*t*190;
  const y=(1-t)*(1-t)*55+2*(1-t)*t*5+t*t*55;
  ['sunDot','sunGlow'].forEach(id=>{document.getElementById(id).setAttribute('cx',x);document.getElementById(id).setAttribute('cy',y);});
}

// â”€â”€ AQI FETCH â”€â”€
async function fetchAQI(lat,lon){
  try{
    const url=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=pm2_5,pm10,carbon_monoxide,nitrogen_dioxide,ozone,uv_index,european_aqi&hourly=pm2_5`;
    const res=await fetch(url);const data=await res.json();
    const c=data.current;
    const aqi=Math.round(c.european_aqi||0);
    let aqiColor='#4ade80',aqiClass='aqi-good',aqiLabel='Good',aqiDesc='Air quality is satisfactory. Ideal conditions for outdoor activities.';
    if(aqi>50){aqiColor='#facc15';aqiClass='aqi-moderate';aqiLabel='Moderate';aqiDesc='Air quality is acceptable. Some people sensitive to air pollution may notice effects.';}
    if(aqi>100){aqiColor='#fb923c';aqiClass='aqi-unhealthy';aqiLabel='Unhealthy for Sensitive Groups';aqiDesc='Members of sensitive groups may experience health effects. General public is not affected.';}
    if(aqi>150){aqiColor='#ef4444';aqiClass='aqi-bad';aqiLabel='Unhealthy';aqiDesc='Everyone may experience health effects. Sensitive groups may experience more serious effects.';}
    document.getElementById('aqNum').textContent=aqi;
    document.getElementById('aqStatus').textContent=aqiLabel;
    document.getElementById('aqDesc').textContent=aqiDesc;
    document.getElementById('aqCircle').style.borderColor=aqiColor;
    document.getElementById('aqCircle').style.color=aqiColor;
    document.getElementById('wAQI').textContent=aqi;
    document.getElementById('wAQI').style.color=aqiColor;
    document.getElementById('wAQILabel').textContent=aqiLabel;
    document.getElementById('wAQILabel').className='aqi-label '+aqiClass;
    document.getElementById('wAQIBar').style.width=Math.min(aqi/200*100,100)+'%';
    document.getElementById('wAQIBar').style.background=`linear-gradient(90deg,${aqiColor}99,${aqiColor})`;
    document.getElementById('aqPM25').textContent=`${(c.pm2_5||0).toFixed(1)} Î¼g/mÂ³`;
    document.getElementById('aqPM10').textContent=`${(c.pm10||0).toFixed(1)} Î¼g/mÂ³`;
    document.getElementById('aqUV').textContent=(c.uv_index||0).toFixed(1);
    document.getElementById('aqCO').textContent=`${(c.carbon_monoxide||0).toFixed(0)} ppb`;
    document.getElementById('aqNO2').textContent=`${(c.nitrogen_dioxide||0).toFixed(1)} ppb`;
    document.getElementById('aqO3').textContent=`${(c.ozone||0).toFixed(1)} ppb`;
  }catch(e){console.warn('AQI fetch failed',e);}
}

// â”€â”€ ALERTS FETCH â”€â”€
async function fetchAlerts(lat,lon){
  try{
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=weather_code&daily=weather_code,temperature_2m_max&timezone=auto&forecast_days=1`;
    const res=await fetch(url);const d=await res.json();
    const code=d.current.weather_code;
    const alerts=[];
    if([95,96,99].includes(code))alerts.push({title:'Thunderstorm Warning',sev:'severe',area:'Your Area',body:'A thunderstorm warning is in effect. Dangerous lightning and strong winds expected. Seek shelter immediately and avoid outdoor activities.',eff:'Now',exp:'Until conditions improve'});
    if(d.daily.temperature_2m_max[0]>38)alerts.push({title:'Extreme Heat Advisory',sev:'moderate',area:'Your Area',body:'Dangerous heat conditions expected. Stay hydrated, wear light clothing, and avoid prolonged sun exposure. Check on elderly neighbors.',eff:'Today',exp:'This evening'});
    if(d.daily.temperature_2m_max[0]<-15)alerts.push({title:'Wind Chill Warning',sev:'extreme',area:'Your Area',body:'Dangerously cold wind chill values expected. Frostbite can occur within minutes on exposed skin. Limit outdoor exposure.',eff:'Now',exp:'Tomorrow morning'});
    if([71,73,75].includes(code))alerts.push({title:'Winter Storm Advisory',sev:'moderate',area:'Your Area',body:'Snow accumulations expected. Hazardous road conditions likely. Allow extra travel time and keep an emergency kit in your vehicle.',eff:'Now',exp:'Until clearing'});
    renderAlerts(alerts);
  }catch(e){}
}

function renderAlerts(alerts){
  const badge=document.getElementById('alertBadge');
  const widget=document.getElementById('alertWidget');
  const container=document.getElementById('alertsContainer');
  const list=document.getElementById('alertList');
  const count=document.getElementById('alertCount');
  if(alerts.length===0){
    badge.classList.remove('show');widget.classList.remove('show');
    container.innerHTML='<div style="text-align:center;padding:50px;color:var(--dim);"><div style="font-size:2.5rem;margin-bottom:12px;">âœ…</div><div style="font-family:\'Oswald\',sans-serif;font-size:1.1rem;letter-spacing:3px;color:rgba(255,255,255,0.2);">NO ACTIVE ALERTS</div><div style="font-size:0.8rem;margin-top:8px;">No weather alerts for this location at this time</div></div>';
    return;
  }
  badge.classList.add('show');
  document.getElementById('alertBadgeText').textContent=`${alerts.length} ALERT${alerts.length>1?'S':''}`;
  widget.classList.add('show');
  count.textContent=alerts.length;
  list.innerHTML=alerts.slice(0,3).map(a=>`<div class="alert-item"><i class="fas fa-circle-exclamation alert-icon-sm"></i><div>${a.title}</div></div>`).join('');
  container.innerHTML=alerts.map(a=>{
    const sevMap={extreme:'alert-extreme sev-extreme',severe:'alert-severe sev-severe',moderate:'alert-moderate sev-moderate',minor:'alert-minor sev-minor'};
    const [cardC,sevC]=(sevMap[a.sev]||'alert-minor sev-minor').split(' ');
    return`<div class="alert-full-card ${cardC}"><div class="alert-full-head"><div class="alert-full-title">${a.title}</div><span class="alert-full-sev ${sevC}">${a.sev.toUpperCase()}</span></div><div class="alert-full-area"><i class="fas fa-location-dot"></i> ${a.area}</div><div class="alert-full-body">${a.body}</div><div class="alert-full-times"><span><i class="fas fa-clock"></i> Effective: ${a.eff}</span><span><i class="fas fa-hourglass-end"></i> Expires: ${a.exp}</span></div></div>`;
  }).join('');
}

// â”€â”€ TICKER â”€â”€
function buildTicker(city){
  if(!wxData)return;
  const c=wxData.current,d=wxData.daily;
  const[lbl]=WMO[c.weather_code]||['Unknown'];
  const items=[
    `ğŸ“ ${city} â€” ${lbl} Â· ${tStr(c.temperature_2m)} Â· Feels like ${tStr(c.apparent_temperature)}`,
    `ğŸ’§ Humidity ${c.relative_humidity_2m}% Â· ğŸ’¨ Wind ${windStr(c.wind_speed_10m)} ${wDir(c.wind_direction_10m)} Â· ğŸ”µ Pressure ${Math.round(c.surface_pressure)} hPa`,
    `ğŸ“… Tomorrow: High ${tStr(d.temperature_2m_max[1])} / Low ${tStr(d.temperature_2m_min[1])}`,
    `ğŸŒ… Sunrise ${fmtTime(d.sunrise[0])} Â· ğŸŒ‡ Sunset ${fmtTime(d.sunset[0])} Â· â˜€ï¸ UV ${(c.uv_index||0).toFixed(1)}`,
    `ğŸ“¡ Smokey's Weather Network Â· Live Data Â· Powered by Open-Meteo Global Model`,
  ];
  const sep='<span class="t-sep">â—†</span>';
  document.getElementById('tickerText').innerHTML=items.join(sep)+sep+items.join(sep);
}

// â”€â”€ RENDER WEATHER â”€â”€
function renderWeather(data){
  const c=data.current,d=data.daily,h=data.hourly;
  const[lbl,ico]=WMO[c.weather_code]||['Unknown','â“'];
  // Hero
  document.getElementById('heroTemp').textContent=dT(c.temperature_2m);
  document.getElementById('heroUnit').textContent=`Â°${unit}`;
  document.getElementById('heroIcon').textContent=ico;
  document.getElementById('heroCond').textContent=lbl;
  document.getElementById('heroAttr').textContent='Live Â· Open-Meteo GFS + ERA5 Model Â· Updates every 15 min';
  // Stats
  document.getElementById('sHumidity').textContent=`${c.relative_humidity_2m}%`;
  document.getElementById('sWind').textContent=windStr(c.wind_speed_10m);
  document.getElementById('sVis').textContent=unit==='F'?`${(c.visibility/1609.34).toFixed(1)}mi`:`${(c.visibility/1000).toFixed(1)}km`;
  document.getElementById('sPressure').textContent=`${Math.round(c.surface_pressure)}hPa`;
  document.getElementById('sDew').textContent=tStr(c.dew_point_2m);
  document.getElementById('sCloud').textContent=`${c.cloud_cover}%`;
  document.getElementById('sUV').textContent=(c.uv_index||0).toFixed(1);
  const pre=unit==='F'?`${(c.precipitation*0.0394).toFixed(2)}"`:`${c.precipitation.toFixed(1)}mm`;
  document.getElementById('sPrecip').textContent=pre;
  // Feels like
  const fl=dT(c.apparent_temperature);
  document.getElementById('wFeels').textContent=`${fl}Â°`;
  const diff=c.apparent_temperature-c.temperature_2m;
  document.getElementById('wFeelsDesc').textContent=diff<-3?'Wind chill makes it feel colder':diff>3?'Humidity makes it feel warmer':'Close to the actual temperature';
  document.getElementById('wFeelsBar').style.width=Math.min(Math.max((c.apparent_temperature+20)/80*100,5),95)+'%';
  // Wind
  document.getElementById('wWindBig').textContent=windStr(c.wind_speed_10m);
  document.getElementById('wWindDir').textContent=`Direction: ${wDir(c.wind_direction_10m)} (${Math.round(c.wind_direction_10m)}Â°)`;
  document.getElementById('wWindGust').textContent=`Gusts: ${windStr(c.wind_gusts_10m||c.wind_speed_10m)}`;
  document.getElementById('wWindBar').style.width=Math.min(c.wind_speed_10m/65*100,100)+'%';
  // Sunrise/Sunset
  document.getElementById('sunRise').textContent=fmtTime(d.sunrise[0]);
  document.getElementById('sunSet').textContent=fmtTime(d.sunset[0]);
  updateSunArc(d.sunrise[0],d.sunset[0]);
  // 7-Day
  render7Day(d,'forecast7');render7Day(d,'forecast7b');
  // Hourly
  renderHourly(h,'hourlyScroll');renderHourly(h,'hourlyScroll2');
  // FX
  applyFX(c.weather_code);
  // Ticker
  buildTicker(currentCity);
  // Broadcast overlays
  document.getElementById('bcastCity').textContent=`ğŸ“ ${currentCity}`;
  document.getElementById('bcastTemp').textContent=`${dT(c.temperature_2m)}Â°${unit} â€” ${lbl}`;
  document.getElementById('bcastCond').textContent=`Humidity ${c.relative_humidity_2m}% Â· Wind ${windStr(c.wind_speed_10m)} ${wDir(c.wind_direction_10m)}`;
  document.getElementById('bcastTickerInner').innerHTML=document.getElementById('tickerText').innerHTML;
}

function render7Day(d,elId){
  const el=document.getElementById(elId);if(!el)return;
  const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];el.innerHTML='';
  for(let i=0;i<7;i++){
    const date=new Date(d.time[i]);
    const[,ico]=WMO[d.weather_code[i]]||['--','â“'];
    const precip=d.precipitation_sum[i];
    const div=document.createElement('div');
    div.className='fday'+(i===0?' today':'');
    div.innerHTML=`<div class="fday-name">${i===0?'Today':days[date.getDay()]}</div><div class="fday-icon">${ico}</div><div class="fday-hi">${dT(d.temperature_2m_max[i])}Â°</div><div class="fday-lo">${dT(d.temperature_2m_min[i])}Â°</div><div class="fday-precip">${precip>0?(unit==='F'?(precip*0.0394).toFixed(2)+'"':precip.toFixed(1)+'mm'):'â€”'}</div>`;
    el.appendChild(div);
  }
}

function renderHourly(h,elId){
  const el=document.getElementById(elId);if(!el)return;
  el.innerHTML='';
  const now=new Date();
  let startIdx=0;
  for(let i=0;i<h.time.length;i++){if(new Date(h.time[i])>=now){startIdx=i;break;}}
  const count=elId==='hourlyScroll2'?48:24;
  for(let i=startIdx;i<Math.min(startIdx+count,h.time.length);i++){
    const[,ico]=WMO[h.weather_code[i]]||['--','â“'];
    const div=document.createElement('div');
    div.className='hour-card'+(i===startIdx?' now':'');
    div.innerHTML=`<div class="hour-time">${i===startIdx?'NOW':fmtHour(h.time[i])}</div><div class="hour-icon">${ico}</div><div class="hour-temp">${dT(h.temperature_2m[i])}Â°</div><div class="hour-precip">${h.precipitation_probability?.[i]||0}% ğŸ’§</div>`;
    el.appendChild(div);
  }
}

// â”€â”€ FETCH WEATHER â”€â”€
async function fetchWeather(lat,lon,city,region){
  document.getElementById('siteLoader').classList.remove('gone');
  document.getElementById('errMsg').classList.remove('show');
  currentLat=lat;currentLon=lon;currentCity=city;
  try{
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,relative_humidity_2m,dew_point_2m,precipitation,weather_code,cloud_cover,surface_pressure,wind_speed_10m,wind_direction_10m,wind_gusts_10m,visibility,uv_index&hourly=temperature_2m,weather_code,precipitation_probability&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,sunrise,sunset&wind_speed_unit=mph&forecast_days=7&timezone=auto`;
    const res=await fetch(url);if(!res.ok)throw new Error('Weather fetch failed');
    const data=await res.json();wxData=data;
    document.getElementById('heroCity').textContent=city;
    document.getElementById('heroRegion').textContent=region||'';
    renderWeather(data);
    await Promise.all([fetchAQI(lat,lon),fetchAlerts(lat,lon)]);
    // Radar update
    document.getElementById('radarFrame').src=`https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&detailLat=${lat}&detailLon=${lon}&width=100%&height=520&zoom=7&level=surface&overlay=rain&product=ecmwf&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1`;
    loadNews();
  }catch(e){
    document.getElementById('errMsg').textContent='Failed to load weather data. Please try again.';
    document.getElementById('errMsg').classList.add('show');
  }finally{document.getElementById('siteLoader').classList.add('gone');}
}

async function doSearch(){
  const val=document.getElementById('citySearch').value.trim();if(!val)return;
  document.getElementById('errMsg').classList.remove('show');
  try{
    const res=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(val)}&count=1&language=en&format=json`);
    const data=await res.json();
    if(!data.results?.length)throw new Error('Not found');
    const g=data.results[0];
    await fetchWeather(g.latitude,g.longitude,g.name,`${g.admin1||''} ${g.country_code||''}`.trim());
  }catch(e){
    document.getElementById('siteLoader').classList.add('gone');
    document.getElementById('errMsg').textContent='Location not found. Try a different city name.';
    document.getElementById('errMsg').classList.add('show');
  }
}

function doLocate(){
  if(!navigator.geolocation){document.getElementById('errMsg').textContent='Geolocation not supported in this browser.';document.getElementById('errMsg').classList.add('show');return;}
  document.getElementById('siteLoader').classList.remove('gone');
  navigator.geolocation.getCurrentPosition(async pos=>{
    const{latitude:lat,longitude:lon}=pos.coords;
    try{
      const res=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
      const g=await res.json();
      const city=g.address.city||g.address.town||g.address.village||'Your Location';
      const region=`${g.address.state||''} ${(g.address.country_code||'').toUpperCase()}`.trim();
      await fetchWeather(lat,lon,city,region);
    }catch{await fetchWeather(lat,lon,'Your Location','');}
  },()=>{document.getElementById('siteLoader').classList.add('gone');document.getElementById('errMsg').textContent='Location access denied. Search manually.';document.getElementById('errMsg').classList.add('show');});
}

document.getElementById('citySearch').addEventListener('keydown',e=>{if(e.key==='Enter')doSearch();});
setInterval(()=>{if(currentLat&&currentLon)fetchWeather(currentLat,currentLon,currentCity,'');},15*60*1000);

// â”€â”€ NEWS â”€â”€
const NEWS_STORIES=[
  {cat:'Severe Weather',icon:'â›ˆï¸',headline:'Historic Storm System Tracks Across Central Plains',snippet:'Meteorologists are tracking a powerful low-pressure system bringing severe thunderstorm and tornado threats to the central United States. Residents should monitor local alerts.',time:'2 hours ago',src:'SWN Staff'},
  {cat:'Climate',icon:'ğŸŒ¡ï¸',headline:'Record High Temperatures Expected Across Southwest This Week',snippet:'A sprawling heat dome is expected to push temperatures to record levels across the Desert Southwest. Heat advisories and excessive heat warnings are likely to be issued.',time:'4 hours ago',src:'SWN Staff'},
  {cat:'Winter Weather',icon:'â„ï¸',headline:'Early Season Snow Event Possible for Northern Rockies',snippet:'A sharp cold front is set to deliver the first significant snowfall of the season to portions of Montana and Wyoming, with accumulations possible in higher elevations.',time:'6 hours ago',src:'SWN Staff'},
  {cat:'Tropical',icon:'ğŸŒ€',headline:'Tropical Disturbance in Atlantic Being Monitored by NHC',snippet:'The National Hurricane Center is monitoring a tropical disturbance in the central Atlantic Ocean that has a moderate chance of development over the next five days.',time:'8 hours ago',src:'SWN Staff'},
  {cat:'Forecast',icon:'ğŸŒ¤ï¸',headline:'Weekend Outlook: Mostly Pleasant Conditions Expected Nationwide',snippet:'A tranquil weather pattern is setting up for much of the country heading into the weekend, with below-normal temperatures and low precipitation chances.',time:'12 hours ago',src:'SWN Staff'},
];
const TRENDING=['Hurricane Season 2025 Forecast','Record Heat Wave Southwest','La NiÃ±a Winter Outlook','Tornado Alley Activity Tracker','Great Lakes Snow Belt Update'];

function loadNews(){
  document.getElementById('newsFeed').innerHTML=NEWS_STORIES.map(s=>`<div class="news-card"><div class="news-cat-icon">${s.icon}</div><div class="news-content"><div class="news-cat-tag">${s.cat}</div><div class="news-headline">${s.headline}</div><div class="news-snippet">${s.snippet}</div><div class="news-meta"><span><i class="fas fa-clock"></i> ${s.time}</span><span><i class="fas fa-user"></i> ${s.src}</span></div></div></div>`).join('');
  document.getElementById('trendingList').innerHTML=TRENDING.map((t,i)=>`<div class="trending-item"><div class="trending-num">${i+1}</div><div class="trending-text">${t}</div></div>`).join('');
}
loadNews();

// â”€â”€ VIDEOS â”€â”€
function renderVideos(){
  const grid=document.getElementById('videoGrid');
  const empty=document.getElementById('videoEmpty');
  if(!videos.length){grid.innerHTML='';empty.classList.add('show');return;}
  empty.classList.remove('show');
  const tagMap={report:'tag-report',live:'tag-live',clip:'tag-clip',upload:'tag-upload'};
  const tagLabel={report:'Weather Report',live:'Live Broadcast',clip:'Field Clip',upload:'Uploaded'};
  grid.innerHTML=videos.map((v,i)=>{
    let thumbHTML='';
    if(v.ytId){
      thumbHTML=`<img src="https://img.youtube.com/vi/${v.ytId}/hqdefault.jpg" alt="${v.title}" onerror="this.parentElement.innerHTML='<div class=\\"video-thumb-placeholder\\"><div style=\\"font-size:2rem;\\">ğŸ“¹</div><div style=\\"font-size:0.72rem;\\">Video</div></div>'"/>`;
    }else if(v.fileData){
      thumbHTML=`<video src="${v.fileData}" style="width:100%;height:100%;object-fit:cover;" preload="metadata"></video>`;
    }else{
      thumbHTML=`<div class="video-thumb-placeholder"><div style="font-size:2rem;">ğŸ“¹</div><div style="font-size:0.72rem;letter-spacing:1px;">VIDEO CLIP</div></div>`;
    }
    return`<div class="video-card"><div class="video-thumb" onclick="playVideo(${i})">${thumbHTML}<div class="video-play-overlay"><div class="play-circle">â–¶</div></div></div><div class="video-body"><div class="video-tag-row"><span class="video-tag ${tagMap[v.cat]||'tag-clip'}">${tagLabel[v.cat]||'Clip'}</span><span class="video-date">${v.date}</span></div><div class="video-title">${v.title}</div><div class="video-desc">${v.desc||'No description provided.'}</div><div class="video-actions"><button class="v-act-btn" onclick="playVideo(${i})"><i class="fas fa-play"></i> Play</button><button class="v-act-btn del" onclick="deleteVideo(${i})"><i class="fas fa-trash"></i> Delete</button></div></div></div>`;
  }).join('');
}
renderVideos();

function toggleVideoForm(){document.getElementById('videoFormWrap').classList.toggle('open');}

function saveVideo(){
  const title=document.getElementById('vTitle').value.trim();
  if(!title){alert('Please enter a title.');return;}
  const url=document.getElementById('vURL').value.trim();
  const file=document.getElementById('vFile').files[0];
  const cat=document.getElementById('vCat').value;
  const desc=document.getElementById('vDesc').value.trim();
  const vid={title,cat,desc,date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})};
  // YouTube
  const ytMatch=url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]{11})/);
  if(ytMatch)vid.ytId=ytMatch[1];
  else if(url)vid.url=url;
  if(file){
    const reader=new FileReader();
    reader.onload=e=>{vid.fileData=e.target.result;videos.unshift(vid);localStorage.setItem('swn_videos',JSON.stringify(videos));renderVideos();toggleVideoForm();resetForm();};
    reader.readAsDataURL(file);return;
  }
  videos.unshift(vid);localStorage.setItem('swn_videos',JSON.stringify(videos));renderVideos();toggleVideoForm();resetForm();
}

function resetForm(){['vTitle','vURL','vDesc'].forEach(id=>document.getElementById(id).value='');document.getElementById('vFile').value='';}

function deleteVideo(i){if(!confirm('Delete this video?'))return;videos.splice(i,1);localStorage.setItem('swn_videos',JSON.stringify(videos));renderVideos();}

function playVideo(i){
  const v=videos[i];
  const modal=document.getElementById('videoModal');
  const frame=document.getElementById('videoModalFrame');
  if(v.ytId){frame.innerHTML=`<iframe src="https://www.youtube.com/embed/${v.ytId}?autoplay=1" allow="autoplay;fullscreen" allowfullscreen></iframe>`;}
  else if(v.fileData){frame.innerHTML=`<video src="${v.fileData}" controls autoplay style="width:100%;height:100%;"></video>`;}
  else if(v.url){frame.innerHTML=`<iframe src="${v.url}" allow="autoplay;fullscreen"></iframe>`;}
  else{frame.innerHTML=`<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--dim);font-family:'Oswald',sans-serif;letter-spacing:3px;">NO PLAYBACK AVAILABLE</div>`;}
  modal.classList.add('open');
}
function closeVideoModal(){document.getElementById('videoModal').classList.remove('open');document.getElementById('videoModalFrame').innerHTML='';}

// â”€â”€ RADAR SWITCH â”€â”€
function switchRadar(type,btn){
  document.querySelectorAll('.radar-type-btn').forEach(b=>b.classList.remove('on'));btn.classList.add('on');
  const overlayMap={rain:'rain',wind:'wind',temp:'temp',cloud:'clouds'};
  const overlay=overlayMap[type]||'rain';
  const lat=currentLat||39,lon=currentLon||-98,zoom=currentLat?7:4;
  document.getElementById('radarFrame').src=`https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&detailLat=${lat}&detailLon=${lon}&width=100%&height=520&zoom=${zoom}&level=surface&overlay=${overlay}&product=ecmwf&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1`;
}

// â”€â”€ BROADCAST / GREEN SCREEN â”€â”€
function openPwGate(){document.getElementById('pwGate').classList.add('open');}
function closePwGate(){document.getElementById('pwGate').classList.remove('open');document.getElementById('pwInput').value='';document.getElementById('pwErr').classList.remove('show');}
function checkPassword(){
  const val=document.getElementById('pwInput').value;
  if(val===broadcastPw){closePwGate();startBroadcast();}
  else{document.getElementById('pwErr').classList.add('show');}
}
document.getElementById('pwInput').addEventListener('keydown',e=>{if(e.key==='Enter')checkPassword();});

function changePassword(){
  const np=document.getElementById('newPwInput').value.trim();
  if(!np||np.length<4)return;
  broadcastPw=np;localStorage.setItem('swn_pw',np);
  document.getElementById('newPwInput').value='';
  document.getElementById('pwChangeMsg').style.display='block';
  setTimeout(()=>document.getElementById('pwChangeMsg').style.display='none',3000);
}

async function startBroadcast(){
  const modal=document.getElementById('broadcastModal');
  modal.classList.add('open');
  try{
    broadcastStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:1280},height:{ideal:720}},audio:true});
    const video=document.getElementById('bcastVideo');
    video.srcObject=broadcastStream;
    video.onloadedmetadata=()=>{video.play();broadcastActive=true;renderBroadcastFrame();};
  }catch(e){
    // Fallback: no camera access
    document.getElementById('bcastCanvas').style.background='#0a1628';
    renderStaticBroadcast();
    console.warn('Camera not available:',e);
  }
}

function stopBroadcast(){
  broadcastActive=false;
  if(animFrameId)cancelAnimationFrame(animFrameId);
  if(broadcastStream){broadcastStream.getTracks().forEach(t=>t.stop());broadcastStream=null;}
  document.getElementById('broadcastModal').classList.remove('open');
  document.getElementById('bcastSettings').classList.remove('open');
}

function openSettings(){document.getElementById('bcastSettings').classList.toggle('open');}

function updateChroma(){
  const col=document.getElementById('chromaColor').value;
  chromaR=parseInt(col.slice(1,3),16);
  chromaG=parseInt(col.slice(3,5),16);
  chromaB=parseInt(col.slice(5,7),16);
  chromaThresh=parseInt(document.getElementById('chromaThresh').value);
  chromaSmooth=parseInt(document.getElementById('chromaSmooth').value);
}

function setBg(mode){
  bgMode=mode;
  document.querySelectorAll('.bcast-bg-btn').forEach(b=>b.classList.remove('on'));
  document.getElementById('bg'+mode.charAt(0).toUpperCase()+mode.slice(1)).classList.add('on');
}

// BG canvas animated backgrounds for broadcast
let bgAnim=0;
function drawBroadcastBg(bgCtx,w,h){
  bgAnim+=0.5;
  bgCtx.clearRect(0,0,w,h);
  if(bgMode==='radar'){
    // Radar-style dark blue with circular sweeps
    const grad=bgCtx.createRadialGradient(w/2,h/2,0,w/2,h/2,Math.max(w,h)*0.7);
    grad.addColorStop(0,'#0a1628');grad.addColorStop(1,'#020810');
    bgCtx.fillStyle=grad;bgCtx.fillRect(0,0,w,h);
    // Grid
    bgCtx.strokeStyle='rgba(0,180,100,0.1)';bgCtx.lineWidth=1;
    for(let x=0;x<w;x+=40){bgCtx.beginPath();bgCtx.moveTo(x,0);bgCtx.lineTo(x,h);bgCtx.stroke();}
    for(let y=0;y<h;y+=40){bgCtx.beginPath();bgCtx.moveTo(0,y);bgCtx.lineTo(w,y);bgCtx.stroke();}
    // Radar sweep
    const angle=(bgAnim*3)%360*(Math.PI/180);
    const sweepGrad=bgCtx.createConicalGradient?null:null;
    bgCtx.save();bgCtx.translate(w/2,h/2);
    bgCtx.fillStyle='rgba(0,255,80,0.08)';
    bgCtx.beginPath();bgCtx.moveTo(0,0);bgCtx.arc(0,0,Math.max(w,h),angle-0.8,angle);bgCtx.closePath();bgCtx.fill();
    // Radar circles
    [80,160,240,320].forEach(r=>{bgCtx.beginPath();bgCtx.arc(0,0,r,0,Math.PI*2);bgCtx.strokeStyle='rgba(0,200,80,0.15)';bgCtx.stroke();});
    bgCtx.restore();
    // Sweep line
    bgCtx.save();bgCtx.translate(w/2,h/2);
    bgCtx.strokeStyle='rgba(0,255,80,0.6)';bgCtx.lineWidth=2;
    bgCtx.beginPath();bgCtx.moveTo(0,0);bgCtx.lineTo(Math.cos(angle)*Math.max(w,h),Math.sin(angle)*Math.max(w,h));bgCtx.stroke();bgCtx.restore();
    // Blips
    [[0.3,0.4],[0.6,0.3],[0.7,0.65],[0.45,0.7],[0.8,0.45]].forEach(([fx,fy])=>{
      bgCtx.beginPath();bgCtx.arc(fx*w,fy*h,3+Math.sin(bgAnim*0.1+fx*10)*1,0,Math.PI*2);
      bgCtx.fillStyle=`rgba(0,255,80,${0.4+Math.sin(bgAnim*0.15)*0.3})`;bgCtx.fill();
    });
  }else if(bgMode==='storm'){
    // Dark stormy sky
    bgCtx.fillStyle='#080c14';bgCtx.fillRect(0,0,w,h);
    // Cloud layers
    const t=bgAnim*0.3;
    [[0.2,0.2,w*0.8,h*0.3,'rgba(30,40,60,0.9)'],[0.5,0.15,w*0.6,h*0.2,'rgba(20,30,50,0.8)'],[0.1,0.35,w*0.9,h*0.25,'rgba(25,35,55,0.7)']].forEach(([cx,cy,cw,ch,color])=>{
      bgCtx.fillStyle=color;bgCtx.beginPath();bgCtx.ellipse((cx+Math.sin(t*0.1)*0.02)*w,cy*h,cw/2,ch/2,0,0,Math.PI*2);bgCtx.fill();
    });
    // Lightning
    if(Math.floor(bgAnim/30)%8===0){
      bgCtx.strokeStyle='rgba(200,220,255,0.9)';bgCtx.lineWidth=2;
      bgCtx.beginPath();const lx=w*0.4;bgCtx.moveTo(lx,0);bgCtx.lineTo(lx-20,h*0.3);bgCtx.lineTo(lx+10,h*0.3);bgCtx.lineTo(lx-30,h*0.7);bgCtx.stroke();
      bgCtx.fillStyle='rgba(200,220,255,0.05)';bgCtx.fillRect(0,0,w,h);
    }
    // Rain
    bgCtx.strokeStyle='rgba(140,180,220,0.3)';bgCtx.lineWidth=1;
    for(let i=0;i<80;i++){
      const rx=(i*137+bgAnim*3)%w;const ry=(i*73+bgAnim*8)%h;
      bgCtx.beginPath();bgCtx.moveTo(rx,ry);bgCtx.lineTo(rx-3,ry+15);bgCtx.stroke();
    }
  }else if(bgMode==='map'){
    // Satellite map style
    bgCtx.fillStyle='#1a3a5c';bgCtx.fillRect(0,0,w,h);
    // Land masses (simple shapes)
    bgCtx.fillStyle='#2d5a27';
    [[0,0.4,0.5,0.6],[0.4,0.3,0.35,0.5],[0.6,0.1,0.4,0.4],[0.1,0,0.25,0.35]].forEach(([x,y,sw,sh])=>{
      bgCtx.beginPath();bgCtx.roundRect?bgCtx.roundRect(x*w,y*h,sw*w,sh*h,20):bgCtx.fillRect(x*w,y*h,sw*w,sh*h);bgCtx.fill();
    });
    // Grid lines
    bgCtx.strokeStyle='rgba(100,180,255,0.12)';bgCtx.lineWidth=1;
    for(let i=0;i<6;i++){bgCtx.beginPath();bgCtx.moveTo(0,i*h/5);bgCtx.lineTo(w,i*h/5);bgCtx.stroke();bgCtx.beginPath();bgCtx.moveTo(i*w/5,0);bgCtx.lineTo(i*w/5,h);bgCtx.stroke();}
    // Weather overlay dots
    [[0.2,0.3,'rgba(0,150,255,0.5)'],[0.5,0.4,'rgba(255,100,0,0.4)'],[0.7,0.6,'rgba(0,200,100,0.4)'],[0.35,0.7,'rgba(100,100,255,0.4)']].forEach(([fx,fy,col])=>{
      const gr=bgCtx.createRadialGradient(fx*w,fy*h,0,fx*w,fy*h,60+Math.sin(bgAnim*0.05+fx)*10);
      gr.addColorStop(0,col);gr.addColorStop(1,'transparent');bgCtx.fillStyle=gr;bgCtx.fillRect(0,0,w,h);
    });
  }else{
    // Clear sky gradient
    const grad=bgCtx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,'#0a4080');grad.addColorStop(0.6,'#1a6abf');grad.addColorStop(1,'#87ceeb');
    bgCtx.fillStyle=grad;bgCtx.fillRect(0,0,w,h);
    // Sun
    const sunX=w*0.75,sunY=h*0.2;
    const sunGrad=bgCtx.createRadialGradient(sunX,sunY,0,sunX,sunY,80);
    sunGrad.addColorStop(0,'rgba(255,230,100,0.95)');sunGrad.addColorStop(0.5,'rgba(255,200,50,0.5)');sunGrad.addColorStop(1,'transparent');
    bgCtx.fillStyle=sunGrad;bgCtx.fillRect(0,0,w,h);
    // Clouds
    [[0.1,0.25],[0.5,0.15],[0.65,0.3]].forEach(([cx,cy])=>{
      bgCtx.fillStyle='rgba(255,255,255,0.85)';
      bgCtx.beginPath();bgCtx.arc((cx+Math.sin(bgAnim*0.008+cx)*0.02)*w,cy*h,35,0,Math.PI*2);bgCtx.fill();
      bgCtx.beginPath();bgCtx.arc((cx+0.04+Math.sin(bgAnim*0.008+cx)*0.02)*w,(cy+0.01)*h,28,0,Math.PI*2);bgCtx.fill();
      bgCtx.beginPath();bgCtx.arc((cx-0.03+Math.sin(bgAnim*0.008+cx)*0.02)*w,(cy+0.02)*h,24,0,Math.PI*2);bgCtx.fill();
    });
  }
}

function renderBroadcastFrame(){
  if(!broadcastActive)return;
  const video=document.getElementById('bcastVideo');
  const canvas=document.getElementById('bcastCanvas');
  const bgCanvas=document.getElementById('bgCanvas');
  const ctx=canvas.getContext('2d');
  const bgCtx=bgCanvas.getContext('2d');
  const w=canvas.parentElement.clientWidth,h=canvas.parentElement.clientHeight;
  canvas.width=w;canvas.height=h;bgCanvas.width=w;bgCanvas.height=h;
  // Draw BG
  drawBroadcastBg(bgCtx,w,h);
  // Draw chroma-keyed video
  if(video.readyState>=2&&video.videoWidth>0){
    const offscreen=document.createElement('canvas');
    offscreen.width=video.videoWidth;offscreen.height=video.videoHeight;
    const oc=offscreen.getContext('2d');
    oc.drawImage(video,0,0);
    const frame=oc.getImageData(0,0,offscreen.width,offscreen.height);
    const d=frame.data;
    for(let i=0;i<d.length;i+=4){
      const dr=d[i]-chromaR,dg=d[i+1]-chromaG,db=d[i+2]-chromaB;
      const dist=Math.sqrt(dr*dr+dg*dg+db*db);
      if(dist<chromaThresh){d[i+3]=0;}
      else if(dist<chromaThresh+chromaSmooth){d[i+3]=Math.round((dist-chromaThresh)/chromaSmooth*255);}
    }
    oc.putImageData(frame,0,0);
    // Scale and center
    const aspect=video.videoWidth/video.videoHeight;
    let dw=w,dh=h;
    if(w/h>aspect){dh=h;dw=h*aspect;}else{dw=w;dh=w/aspect;}
    ctx.drawImage(offscreen,(w-dw)/2,(h-dh)/2,dw,dh);
  }
  animFrameId=requestAnimationFrame(renderBroadcastFrame);
}

function renderStaticBroadcast(){
  const bgCanvas=document.getElementById('bgCanvas');
  const bgCtx=bgCanvas.getContext('2d');
  const w=bgCanvas.parentElement.clientWidth,h=bgCanvas.parentElement.clientHeight;
  bgCanvas.width=w;bgCanvas.height=h;
  function loop(){drawBroadcastBg(bgCtx,w,h);animFrameId=requestAnimationFrame(loop);}
  loop();
}

// â”€â”€ BOOT â”€â”€
(async()=>{
  try{
    const res=await fetch('https://geocoding-api.open-meteo.com/v1/search?name=New+York&count=1&language=en&format=json');
    const data=await res.json();
    const g=data.results[0];
    await fetchWeather(g.latitude,g.longitude,'New York','NY, US');
  }catch(e){document.getElementById('siteLoader').classList.add('gone');}
})();
</script>
</body>
</html>
